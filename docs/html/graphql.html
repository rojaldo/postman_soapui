<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.26">
<meta name="author" content="GraphQL Academy">
<title>CURSO DE GRAPHQL</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.square{list-style-type:square}
ul.circle ul:not([class]),ul.disc ul:not([class]),ul.square ul:not([class]){list-style:inherit}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child{border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}
details>summary::-webkit-details-marker{display:none}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:first-child,.sidebarblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child,.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock pre>code{display:block}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos,pre.pygments .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
pre.pygments span.linenos{display:inline-block;margin-right:.75em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
li>p:empty:only-child::before{content:"";display:inline-block}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active,#footnotes .footnote a:first-of-type:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,td.hdlist1,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>CURSO DE GRAPHQL</h1>
<div class="details">
<span id="author" class="author">GraphQL Academy</span><br>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_introducción">Introducción</a>
<ul class="sectlevel2">
<li><a href="#_objetivos">Objetivos</a></li>
<li><a href="#_requisitos">Requisitos</a></li>
<li><a href="#_duración">Duración</a></li>
</ul>
</li>
<li><a href="#_temario">Temario</a>
<ul class="sectlevel2">
<li><a href="#_módulo_1_fundamentos_7_horas">MÓDULO 1: Fundamentos (7 horas)</a></li>
<li><a href="#_módulo_2_esquemas_8_horas">MÓDULO 2: Esquemas (8 horas)</a></li>
<li><a href="#_módulo_3_queries_8_horas">MÓDULO 3: Queries (8 horas)</a></li>
<li><a href="#_módulo_4_mutations_y_subscriptions_6_horas">MÓDULO 4: Mutations y Subscriptions (6 horas)</a></li>
<li><a href="#_módulo_5_servidores_graphql_8_horas">MÓDULO 5: Servidores GraphQL (8 horas)</a></li>
<li><a href="#_módulo_6_autenticación_y_seguridad_7_horas">MÓDULO 6: Autenticación y Seguridad (7 horas)</a></li>
<li><a href="#_módulo_7_clientes_graphql_8_horas">MÓDULO 7: Clientes GraphQL (8 horas)</a></li>
<li><a href="#_módulo_8_testing_7_horas">MÓDULO 8: Testing (7 horas)</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_introducción">Introducción</h2>
<div class="sectionbody">
<div class="paragraph">
<p><strong>GraphQL</strong> es un lenguaje de consulta moderno para APIs. Aprenderás a diseñar, implementar y consumir APIs GraphQL eficientes.</p>
</div>
<div class="sect2">
<h3 id="_objetivos">Objetivos</h3>
<div class="ulist">
<ul>
<li>
<p>Conceptos fundamentales de GraphQL</p>
</li>
<li>
<p>Diseño de esquemas eficientes</p>
</li>
<li>
<p>Implementación de servidores GraphQL</p>
</li>
<li>
<p>Desarrollo de clientes robustos</p>
</li>
<li>
<p>Mejores prácticas y patrones avanzados</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_requisitos">Requisitos</h3>
<div class="ulist">
<ul>
<li>
<p>Conocimiento de HTTP y REST</p>
</li>
<li>
<p>JavaScript/Node.js</p>
</li>
<li>
<p>JSON</p>
</li>
<li>
<p>Conceptos básicos de programación</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_duración">Duración</h3>
<div class="ulist">
<ul>
<li>
<p><strong>Total:</strong> 40-50 horas</p>
</li>
<li>
<p><strong>Teoría:</strong> 20 horas</p>
</li>
<li>
<p><strong>Práctica:</strong> 20-30 horas</p>
</li>
</ul>
</div>
<hr>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_temario">Temario</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_módulo_1_fundamentos_7_horas">MÓDULO 1: Fundamentos (7 horas)</h3>
<div class="sect3">
<h4 id="_1_1_qué_es_graphql">1.1 ¿Qué es GraphQL?</h4>
<div class="paragraph">
<p><strong>Definición y Conceptos Básicos</strong></p>
</div>
<div class="paragraph">
<p>GraphQL es un <strong>lenguaje de consulta</strong> y <strong>runtime</strong> para APIs (Interfaz de Programación de Aplicaciones) desarrollado por Facebook en 2012 y publicado en 2015. Permite que los clientes soliciten exactamente los datos que necesitan.</p>
</div>
<div class="paragraph">
<p><strong>Características Principales:</strong>
- <strong>Declarativo:</strong> Especificas qué datos necesitas
- <strong>Tipado:</strong> Schema fuertemente tipado
- <strong>Validación automática:</strong> Errores detectados temprano
- <strong>Introspectivo:</strong> Puedes consultar el schema
- <strong>Agnóstico:</strong> Funciona con cualquier BD o idioma</p>
</div>
<div class="paragraph">
<p><strong>GraphQL vs REST</strong></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Aspecto</th>
<th class="tableblock halign-left valign-top">REST</th>
<th class="tableblock halign-left valign-top">GraphQL</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Endpoints</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Múltiples (/users, /posts)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Único endpoint (/graphql)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Datos</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Over-fetching/Under-fetching</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Exactamente lo requerido</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Versionado</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/api/v1/, /api/v2/</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Schema versionado</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Caché</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTTP caching nativo</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Requiere configuración</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Learning Curve</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Simple</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Moderadamente compleja</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Real-time</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Polling/WebSockets</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Subscriptions nativas</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Validación</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Manual</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Automática</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Ejemplo de Comparación:</strong></p>
</div>
<div class="paragraph">
<p><strong>REST - Over-fetching:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>GET /api/users/1
Respuesta: {
  id: 1,
  name: "Juan",
  email: "juan@example.com",
  createdAt: "2023-01-01",
  phone: "1234567890",
  address: "Calle 123",
  ...muchos campos más
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Pero tú solo necesitas: <code>name</code> y <code>email</code></p>
</div>
<div class="paragraph">
<p><strong>GraphQL - Exacto:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>query {
  user(id: 1) {
    name
    email
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Respuesta:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "data": {
    "user": {
      "name": "Juan",
      "email": "juan@example.com"
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Ventajas de GraphQL:</strong>
- ✅ Menor consumo de banda ancha
- ✅ Menos solicitudes al servidor
- ✅ Mejor experiencia en redes lentas
- ✅ Menos mantenimiento de versiones
- ✅ Documentación automática
- ✅ Mejor para desarrolladores</p>
</div>
<div class="paragraph">
<p><strong>Limitaciones de GraphQL:</strong>
- ⚠️ Curva de aprendizaje más pronunciada
- ⚠️ Caching HTTP más complejo
- ⚠️ Requiere serialización y parseo
- ⚠️ Necesita middleware específico
- ⚠️ File uploads requieren soluciones especiales</p>
</div>
<div class="paragraph">
<p><strong>Casos de Uso Ideales para GraphQL:</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Aplicaciones Móviles</strong> - Reducir consumo de datos</p>
</li>
<li>
<p><strong>APIs Públicas</strong> - Documentación automática</p>
</li>
<li>
<p><strong>Microservicios</strong> - Composición de datos</p>
</li>
<li>
<p><strong>Aplicaciones Real-time</strong> - Con Subscriptions</p>
</li>
<li>
<p><strong>Múltiples Clientes</strong> - Web, mobile, IoT</p>
</li>
<li>
<p><strong>Dashboards Complejos</strong> - Datos heterogéneos</p>
</li>
<li>
<p><strong>BFFs (Backend for Frontend)</strong> - Agregación</p>
</li>
<li>
<p><strong>Aplicaciones Rápidas</strong> - Progressive Loading</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><strong>Historia y Evolución:</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>2012:</strong> Facebook desarrolla GraphQL internamente</p>
</li>
<li>
<p><strong>2015:</strong> GraphQL se publica públicamente</p>
</li>
<li>
<p><strong>2017:</strong> GraphQL entra a fase de estabilidad</p>
</li>
<li>
<p><strong>2018:</strong> Apollo GraphQL se vuelve dominante</p>
</li>
<li>
<p><strong>2020:</strong> Adopción masiva en la industria</p>
</li>
<li>
<p><strong>2023:</strong> GraphQL maduro con ecosistema robusto</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Empresas que Usan GraphQL:</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>GitHub, Twitter, Facebook, Instagram</p>
</li>
<li>
<p>Shopify, Stripe, Twitch</p>
</li>
<li>
<p>New York Times, The Guardian</p>
</li>
<li>
<p>Airbnb, Uber Eats, PayPal</p>
</li>
<li>
<p>SpaceX, Navi, y muchas más</p>
</li>
</ul>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="_1_2_conceptos_clave_de_graphql">1.2 Conceptos Clave de GraphQL</h4>
<div class="paragraph">
<p><strong>Queries (Consultas)</strong></p>
</div>
<div class="paragraph">
<p>Una Query es una solicitud para <strong>leer datos</strong>. Es la operación más común.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-graphql" data-lang="graphql">query {
  users {
    id
    name
    email
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Respuesta:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "data": {
    "users": [
      {
        "id": "1",
        "name": "Juan",
        "email": "juan@example.com"
      },
      {
        "id": "2",
        "name": "María",
        "email": "maria@example.com"
      }
    ]
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Mutations (Mutaciones)</strong></p>
</div>
<div class="paragraph">
<p>Una Mutation es una solicitud para <strong>modificar datos</strong> (crear, actualizar, eliminar).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-graphql" data-lang="graphql">mutation {
  createUser(name: "Carlos", email: "carlos@example.com") {
    id
    name
    email
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Respuesta:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "data": {
    "createUser": {
      "id": "3",
      "name": "Carlos",
      "email": "carlos@example.com"
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Subscriptions (Suscripciones)</strong></p>
</div>
<div class="paragraph">
<p>Una Subscription es una conexión permanente para <strong>recibir datos en tiempo real</strong>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-graphql" data-lang="graphql">subscription {
  userCreated {
    id
    name
    createdAt
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Cada vez que se crea un nuevo usuario, el cliente recibe:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "data": {
    "userCreated": {
      "id": "4",
      "name": "Ana",
      "createdAt": "2024-01-15T10:30:00Z"
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Types (Tipos)</strong></p>
</div>
<div class="paragraph">
<p>Un Type define la <strong>estructura de datos</strong>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-graphql" data-lang="graphql">type User {
  id: ID!
  name: String!
  email: String!
  age: Int
  posts: [Post!]!
  createdAt: String!
}

type Post {
  id: ID!
  title: String!
  content: String!
  author: User!
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Explicación de símbolos:
- <code>!</code> = Campo requerido (no puede ser null)
- <code>[&#8230;&#8203;]</code> = Array/Lista
- <code>String</code>, <code>Int</code>, <code>ID</code> = Tipos escalares</p>
</div>
<div class="paragraph">
<p><strong>Resolvers (Resolutores)</strong></p>
</div>
<div class="paragraph">
<p>Un Resolver es una <strong>función que resuelve</strong> un campo. Es el "cómo" se obtienen los datos.</p>
</div>
<div class="paragraph">
<p>Ejemplo en JavaScript:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const resolvers = {
  Query: {
    users: () =&gt; {
      // Obtener usuarios de la BD
      return database.users.findAll();
    },
    user: (parent, args) =&gt; {
      // Obtener un usuario específico
      return database.users.findById(args.id);
    }
  },
  User: {
    posts: (parent) =&gt; {
      // Obtener posts del usuario (parent es el User)
      return database.posts.findByUserId(parent.id);
    }
  }
};</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Fields (Campos)</strong></p>
</div>
<div class="paragraph">
<p>Un Field es una <strong>propiedad de un Type</strong>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-graphql" data-lang="graphql">type User {
  id: ID!           # Campo: id
  name: String!     # Campo: name
  email: String!    # Campo: email
  posts: [Post!]!   # Campo: posts (lista de Post)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Arguments (Argumentos)</strong></p>
</div>
<div class="paragraph">
<p>Los Arguments son <strong>parámetros</strong> que pasas a un resolver.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-graphql" data-lang="graphql">query {
  user(id: "1") {
    name
  }
  posts(limit: 10, offset: 0) {
    title
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>En el schema:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-graphql" data-lang="graphql">type Query {
  user(id: ID!): User
  posts(limit: Int, offset: Int): [Post!]!
}</code></pre>
</div>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="_1_3_arquitectura_de_graphql">1.3 Arquitectura de GraphQL</h4>
<div class="paragraph">
<p><strong>Modelo Cliente-Servidor</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>┌──────────────────┐
│     Cliente      │
│  (React, Vue)    │
└────────┬─────────┘
         │
    GraphQL Query
         │
         ▼
┌──────────────────┐
│  GraphQL Server  │
│   (Apollo, etc)  │
└────────┬─────────┘
         │
    Resuelve datos
         │
         ▼
┌──────────────────┐
│   Datos Source   │
│  (BD, API, etc)  │
└──────────────────┘</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Componentes Principales:</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Cliente GraphQL</strong></p>
<div class="ulist">
<ul>
<li>
<p>Envía queries, mutations, subscriptions</p>
</li>
<li>
<p>Maneja respuestas y errores</p>
</li>
<li>
<p>Ejemplo: Apollo Client, urql</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>Servidor GraphQL</strong></p>
<div class="ulist">
<ul>
<li>
<p>Recibe y valida queries</p>
</li>
<li>
<p>Ejecuta resolvers</p>
</li>
<li>
<p>Retorna datos formateados</p>
</li>
<li>
<p>Ejemplo: Apollo Server, Express GraphQL</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>Schema GraphQL</strong></p>
<div class="ulist">
<ul>
<li>
<p>Define tipos y operaciones permitidas</p>
</li>
<li>
<p>Es el "contrato" entre cliente y servidor</p>
</li>
<li>
<p>Se valida automáticamente</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>Resolvers</strong></p>
<div class="ulist">
<ul>
<li>
<p>Funciones que obtienen datos</p>
</li>
<li>
<p>Ejecutan en orden según la query</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p><strong>Ciclo de Vida de una Query</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>1. Cliente envía query
   │
   ▼
2. Servidor recibe y parsea
   │
   ▼
3. Validar contra schema
   │
   ├─ Error → Retornar error
   │
   ▼
4. Planificar ejecución
   │
   ▼
5. Ejecutar resolvers
   │
   ├─ Resolver de raíz (Query)
   │
   ├─ Resolvers de campos
   │
   └─ Resolvers anidados
   │
   ▼
6. Recopilar resultados
   │
   ▼
7. Retornar al cliente</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Ejemplo Práctico:</strong></p>
</div>
<div class="paragraph">
<p>Query:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-graphql" data-lang="graphql">query {
  user(id: "1") {
    name
    posts {
      title
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Ejecución:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>1. Resolver Query.user(id: "1")
   → Obtiene { id: "1", name: "Juan", ... }

2. Para cada campo solicitado:
   - Field "name" → Ya está en los datos
   - Field "posts" → Necesita resolver User.posts

3. Resolver User.posts(parent: { id: "1" })
   → Obtiene [{ title: "Post 1" }, { title: "Post 2" }]

4. Construir respuesta:
   {
     data: {
       user: {
         name: "Juan",
         posts: [
           { title: "Post 1" },
           { title: "Post 2" }
         ]
       }
     }
   }</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Type System</strong></p>
</div>
<div class="paragraph">
<p>GraphQL es un <strong>sistema de tipos fuertemente tipado</strong>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-graphql" data-lang="graphql"># Tipos Escalares (primitivos)
type User {
  id: ID!          # Identificador único
  name: String!    # Texto
  age: Int         # Número entero
  rating: Float    # Número decimal
  active: Boolean! # Verdadero/Falso
}

# Tipos Complejos
type Post {
  id: ID!
  title: String!
  author: User!    # Referencia a otro tipo
  tags: [String!]! # Array de strings
}

# Tipos Opcionales
type Query {
  user(id: ID!): User          # Puede retornar null
  users: [User!]!              # Array que no puede ser null
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Beneficios del Type System:</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>✅ Validación automática</p>
</li>
<li>
<p>✅ Documentación automática</p>
</li>
<li>
<p>✅ Mejor tooling y autocomplete</p>
</li>
<li>
<p>✅ Errores detectados temprano</p>
</li>
<li>
<p>✅ Seguridad de tipos</p>
</li>
</ul>
</div>
<hr>
</div>
</div>
<div class="sect2">
<h3 id="_módulo_2_esquemas_8_horas">MÓDULO 2: Esquemas (8 horas)</h3>
<div class="sect3">
<h4 id="_2_1_introducción_a_los_tipos_de_datos">2.1 Introducción a los Tipos de Datos</h4>
<div class="paragraph">
<p><strong>Tipos Escalares Básicos</strong></p>
</div>
<div class="paragraph">
<p>Los tipos escalares son los tipos primitivos de GraphQL. Los 5 tipos escalares built-in son:</p>
</div>
<div class="paragraph">
<p><strong>String</strong>
- Cadena de texto Unicode
- Usado para nombres, descripciones, URLs, etc.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-graphql" data-lang="graphql">type User {
  name: String!
  email: String!
  bio: String        # Opcional
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Int</strong>
- Número entero de 32 bits
- Usado para cantidades, edades, conteos, etc.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-graphql" data-lang="graphql">type Product {
  id: Int!
  quantity: Int!
  stock: Int
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Float</strong>
- Número decimal de punto flotante
- Usado para precios, calificaciones, porcentajes, etc.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-graphql" data-lang="graphql">type Product {
  price: Float!
  rating: Float      # Entre 0.0 y 5.0
  discount: Float
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Boolean</strong>
- Valor verdadero o falso
- Usado para banderas, estados, permisos, etc.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-graphql" data-lang="graphql">type User {
  active: Boolean!
  isAdmin: Boolean!
  emailVerified: Boolean
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>ID</strong>
- Identificador único
- Serializado como String
- Indicador de que este campo es un identificador</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-graphql" data-lang="graphql">type User {
  id: ID!            # Identificador único
  postIds: [ID!]!    # Lista de IDs de posts
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Tabla de Tipos Escalares:</strong></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 40%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Tipo</th>
<th class="tableblock halign-left valign-top">Formato</th>
<th class="tableblock halign-left valign-top">Ejemplo</th>
<th class="tableblock halign-left valign-top">Caso de Uso</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Texto</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"Juan", "<a href="mailto:juan@email.com">juan@email.com</a>"</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Nombres, emails, descripciones</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-2^31 a 2^31-1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">42, -10, 0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Conteos, edades, IDs numéricos</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Float</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Punto flotante</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3.14, 9.99, -0.5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Precios, coordenadas, promedios</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true/false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true, false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Estados, banderas, permisos</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"1", "user-123"</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Identificadores únicos</p></td>
</tr>
</tbody>
</table>
<hr>
<div class="paragraph">
<p><strong>Tipos Personalizados (Object Types)</strong></p>
</div>
<div class="paragraph">
<p>Un Object Type define la estructura de un objeto complejo.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-graphql" data-lang="graphql">type User {
  id: ID!
  name: String!
  email: String!
  age: Int
  active: Boolean!
}

type Post {
  id: ID!
  title: String!
  content: String!
  createdAt: String!
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Referenciación entre Tipos:</strong></p>
</div>
<div class="paragraph">
<p>Un Object Type puede referenciar a otros Object Types:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-graphql" data-lang="graphql">type User {
  id: ID!
  name: String!
  posts: [Post!]!    # Lista de Posts
  comments: [Comment!]!
}

type Post {
  id: ID!
  title: String!
  author: User!      # Referencia a User
  comments: [Comment!]!
}

type Comment {
  id: ID!
  content: String!
  author: User!
  post: Post!
}</code></pre>
</div>
</div>
<hr>
<div class="paragraph">
<p><strong>Enumerations (Enums)</strong></p>
</div>
<div class="paragraph">
<p>Un Enum define un conjunto <strong>limitado de valores</strong> permitidos.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-graphql" data-lang="graphql">enum UserRole {
  ADMIN
  MODERATOR
  USER
  GUEST
}

enum OrderStatus {
  PENDING
  PROCESSING
  SHIPPED
  DELIVERED
  CANCELLED
}

type User {
  id: ID!
  name: String!
  role: UserRole!    # Debe ser uno de los valores
}

type Order {
  id: ID!
  status: OrderStatus!
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Ventajas de Enums:</strong></p>
</div>
<div class="paragraph">
<p>✅ Validación automática
✅ Documentación clara
✅ Autocompletado en clientes
✅ Previene valores inválidos</p>
</div>
<div class="paragraph">
<p><strong>Ejemplo de Uso:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-graphql" data-lang="graphql">query {
  users(role: ADMIN) {
    id
    name
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Si intenta pasar un valor inválido:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-graphql" data-lang="graphql">query {
  users(role: INVALID)  # Error: INVALID no es un valor válido
}</code></pre>
</div>
</div>
<hr>
<div class="paragraph">
<p><strong>Interfaces</strong></p>
</div>
<div class="paragraph">
<p>Una Interface define un conjunto de <strong>campos comunes</strong> que múltiples tipos pueden implementar.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-graphql" data-lang="graphql"># Definir la interfaz
interface Node {
  id: ID!
  createdAt: String!
}

# Implementar la interfaz
type User implements Node {
  id: ID!
  createdAt: String!
  name: String!
  email: String!
}

type Post implements Node {
  id: ID!
  createdAt: String!
  title: String!
  content: String!
}

type Comment implements Node {
  id: ID!
  createdAt: String!
  text: String!
  author: User!
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Ejemplo Práctico con Interfaces:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-graphql" data-lang="graphql">interface SearchResult {
  score: Float!
}

type UserResult implements SearchResult {
  score: Float!
  user: User!
}

type PostResult implements SearchResult {
  score: Float!
  post: Post!
}

type Query {
  search(query: String!): [SearchResult!]!
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Query:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-graphql" data-lang="graphql">query {
  search(query: "GraphQL") {
    score
    ... on UserResult {
      user {
        name
      }
    }
    ... on PostResult {
      post {
        title
      }
    }
  }
}</code></pre>
</div>
</div>
<hr>
<div class="paragraph">
<p><strong>Union Types</strong></p>
</div>
<div class="paragraph">
<p>Un Union Type agrupa múltiples tipos que <strong>no comparten interfaz</strong>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-graphql" data-lang="graphql">union SearchResult = User | Post | Comment

type Query {
  search(query: String!): [SearchResult!]!
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Query:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-graphql" data-lang="graphql">query {
  search(query: "GraphQL") {
    ... on User {
      id
      name
      email
    }
    ... on Post {
      id
      title
      content
    }
    ... on Comment {
      id
      text
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Diferencia entre Union e Interface:</strong></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Union</th>
<th class="tableblock halign-left valign-top">Interface</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tipos sin relación</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tipos con campos comunes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sin campos comunes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Comparten campos base</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Más flexible</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Más restrictivo</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ejemplo: SearchResult</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ejemplo: Node</p></td>
</tr>
</tbody>
</table>
<hr>
<div class="paragraph">
<p><strong>Input Types</strong></p>
</div>
<div class="paragraph">
<p>Un Input Type define la estructura de datos <strong>para argumentos de entrada</strong>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-graphql" data-lang="graphql"># Definir el Input Type
input CreateUserInput {
  name: String!
  email: String!
  age: Int
}

input UpdateUserInput {
  name: String
  email: String
  age: Int
}

type Mutation {
  createUser(input: CreateUserInput!): User!
  updateUser(id: ID!, input: UpdateUserInput!): User!
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Ventajas de Input Types:</strong></p>
</div>
<div class="paragraph">
<p>✅ Reutilizable
✅ Documentación clara
✅ Validación automática
✅ Más legible que múltiples argumentos</p>
</div>
<div class="paragraph">
<p><strong>Ejemplo Completo:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-graphql" data-lang="graphql">input CreatePostInput {
  title: String!
  content: String!
  tags: [String!]
  publish: Boolean
}

type Mutation {
  createPost(input: CreatePostInput!): Post!
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Mutation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-graphql" data-lang="graphql">mutation {
  createPost(input: {
    title: "GraphQL Fundamentos"
    content: "Aprende GraphQL desde cero"
    tags: ["graphql", "api", "tutorial"]
    publish: true
  }) {
    id
    title
    createdAt
  }
}</code></pre>
</div>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="_2_2_construcción_de_esquemas">2.2 Construcción de Esquemas</h4>
<div class="paragraph">
<p><strong>Estructura Básica de un Schema</strong></p>
</div>
<div class="paragraph">
<p>Un schema GraphQL tiene tres tipos de raíz principales:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-graphql" data-lang="graphql">type Query {
  # Operaciones de lectura
}

type Mutation {
  # Operaciones de escritura
}

type Subscription {
  # Operaciones en tiempo real
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Query Type (Punto de Entrada)</strong></p>
</div>
<div class="paragraph">
<p>Define todas las operaciones de <strong>lectura disponibles</strong>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-graphql" data-lang="graphql">type Query {
  # Obtener un usuario por ID
  user(id: ID!): User

  # Obtener todos los usuarios
  users(limit: Int, offset: Int): [User!]!

  # Buscar usuarios
  searchUsers(query: String!): [User!]!

  # Obtener posts
  posts(userId: ID): [Post!]!
  post(id: ID!): Post
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Mutation Type (Punto de Escritura)</strong></p>
</div>
<div class="paragraph">
<p>Define todas las operaciones de <strong>modificación de datos</strong>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-graphql" data-lang="graphql">type Mutation {
  # Crear un nuevo usuario
  createUser(input: CreateUserInput!): User!

  # Actualizar usuario
  updateUser(id: ID!, input: UpdateUserInput!): User

  # Eliminar usuario
  deleteUser(id: ID!): Boolean!

  # Crear post
  createPost(input: CreatePostInput!): Post!

  # Actualizar post
  updatePost(id: ID!, input: UpdatePostInput!): Post

  # Eliminar post
  deletePost(id: ID!): Boolean!
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Subscription Type (Tiempo Real)</strong></p>
</div>
<div class="paragraph">
<p>Define todas las operaciones de <strong>datos en tiempo real</strong>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-graphql" data-lang="graphql">type Subscription {
  # Notificación cuando se crea un usuario
  userCreated: User!

  # Notificación cuando se crea un post
  postCreated(userId: ID): Post!

  # Notificación de mensajes en vivo
  messageReceived(userId: ID!): Message!
}</code></pre>
</div>
</div>
<hr>
<div class="paragraph">
<p><strong>Schema Completo Ejemplo: Blog</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-graphql" data-lang="graphql"># ========== ENUMS ==========
enum UserRole {
  ADMIN
  AUTHOR
  READER
}

enum PostStatus {
  DRAFT
  PUBLISHED
  ARCHIVED
}

# ========== INPUT TYPES ==========
input CreateUserInput {
  name: String!
  email: String!
  password: String!
}

input CreatePostInput {
  title: String!
  content: String!
  tags: [String!]
}

# ========== OBJECT TYPES ==========
type User {
  id: ID!
  name: String!
  email: String!
  role: UserRole!
  posts: [Post!]!
  createdAt: String!
}

type Post {
  id: ID!
  title: String!
  content: String!
  status: PostStatus!
  author: User!
  tags: [String!]!
  comments: [Comment!]!
  createdAt: String!
  updatedAt: String!
}

type Comment {
  id: ID!
  content: String!
  author: User!
  post: Post!
  createdAt: String!
}

# ========== ROOT TYPES ==========
type Query {
  user(id: ID!): User
  users: [User!]!
  post(id: ID!): Post
  posts(status: PostStatus): [Post!]!
  postsByAuthor(authorId: ID!): [Post!]!
}

type Mutation {
  createUser(input: CreateUserInput!): User!
  createPost(input: CreatePostInput!): Post!
  publishPost(postId: ID!): Post!
  deletePost(postId: ID!): Boolean!
}

type Subscription {
  postPublished: Post!
  newComment(postId: ID!): Comment!
}</code></pre>
</div>
</div>
<hr>
<div class="paragraph">
<p><strong>Directivas</strong></p>
</div>
<div class="paragraph">
<p>Las directivas son <strong>instrucciones especiales</strong> que modifican el comportamiento de campos y fragmentos.</p>
</div>
<div class="paragraph">
<p><strong>Directivas Built-in:</strong></p>
</div>
<div class="paragraph">
<p><strong>@skip</strong>
- Omitir un campo basado en una condición</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-graphql" data-lang="graphql">query GetUser($includeEmail: Boolean!) {
  user(id: "1") {
    id
    name
    email @skip(if: !$includeEmail)
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>@include</strong>
- Incluir un campo basado en una condición</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-graphql" data-lang="graphql">query GetUser($includeEmail: Boolean!) {
  user(id: "1") {
    id
    name
    email @include(if: $includeEmail)
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>@deprecated</strong>
- Marcar un campo como obsoleto</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-graphql" data-lang="graphql">type User {
  id: ID!
  name: String!
  email: String!
  oldEmail: String @deprecated(reason: "Usar field 'email' en su lugar")
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Directivas Personalizadas:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-graphql" data-lang="graphql">directive @auth(role: String) on FIELD_DEFINITION

type Query {
  adminUsers: [User!]! @auth(role: "ADMIN")
  allUsers: [User!]!
}</code></pre>
</div>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="_2_3_mejores_prácticas_en_diseño_de_esquemas">2.3 Mejores Prácticas en Diseño de Esquemas</h4>
<div class="paragraph">
<p><strong>Convenciones de Nombres</strong></p>
</div>
<div class="paragraph">
<p><strong>PascalCase para Tipos:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-graphql" data-lang="graphql">type User { }
type BlogPost { }
type CommentThread { }</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>camelCase para Campos:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-graphql" data-lang="graphql">type User {
  firstName: String!
  lastName: String!
  emailAddress: String!
  createdAt: String!
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>SCREAMING_SNAKE_CASE para Enums:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-graphql" data-lang="graphql">enum UserRole {
  ADMIN
  MODERATOR
  USER
}

enum OrderStatus {
  PENDING
  PROCESSING
  SHIPPED
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Nombres Descriptivos:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-graphql" data-lang="graphql"># ❌ Malo
type U {
  nm: String!
  em: String!
}

# ✅ Bueno
type User {
  name: String!
  email: String!
}</code></pre>
</div>
</div>
<hr>
<div class="paragraph">
<p><strong>Organización y Modularidad</strong></p>
</div>
<div class="paragraph">
<p><strong>Estructura de Carpetas Recomendada:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>src/
├── schema/
│   ├── schema.graphql         # Schema principal
│   ├── types/
│   │   ├── user.graphql
│   │   ├── post.graphql
│   │   └── comment.graphql
│   ├── mutations/
│   │   ├── user.graphql
│   │   └── post.graphql
│   └── queries/
│       ├── user.graphql
│       └── post.graphql
├── resolvers/
│   ├── userResolver.js
│   ├── postResolver.js
│   └── commentResolver.js
└── server.js</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Schema Modularizado (schema.graphql):</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-graphql" data-lang="graphql"># Types
#include "./types/user.graphql"
#include "./types/post.graphql"
#include "./types/comment.graphql"

# Root Types
type Query {
  #include "./queries/user.graphql"
  #include "./queries/post.graphql"
}

type Mutation {
  #include "./mutations/user.graphql"
  #include "./mutations/post.graphql"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>user.graphql:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-graphql" data-lang="graphql">type User {
  id: ID!
  name: String!
  email: String!
  posts: [Post!]!
}</code></pre>
</div>
</div>
<hr>
<div class="paragraph">
<p><strong>Versionado de API</strong></p>
</div>
<div class="paragraph">
<p><strong>Opción 1: Schema Versionado con Alias</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-graphql" data-lang="graphql">type Query {
  # V1 API (deprecated)
  getUser(id: ID!): UserV1 @deprecated(reason: "Usar 'user' en su lugar")

  # V2 API (actual)
  user(id: ID!): User!
}

type UserV1 {
  id: ID!
  name: String!
}

type User {
  id: ID!
  name: String!
  email: String!
  email_verified: Boolean!
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Opción 2: Evolución Gradual</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-graphql" data-lang="graphql">type User {
  id: ID!
  name: String!
  email: String!
  # Nuevo campo
  emailVerified: Boolean!

  # Campo antiguo (deprecated)
  verified: Boolean @deprecated(reason: "Usar 'emailVerified'")
}</code></pre>
</div>
</div>
<hr>
<div class="paragraph">
<p><strong>Evolución de Esquemas Sin Romper Clientes</strong></p>
</div>
<div class="paragraph">
<p><strong>Agregar Campos Opcionales:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-graphql" data-lang="graphql"># ✅ Seguro - No rompe clientes existentes
type User {
  id: ID!
  name: String!
  email: String!
  phone: String    # Nuevo campo opcional
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Agregar a Enums:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-graphql" data-lang="graphql"># ✅ Seguro - Clientes ignorarán valores desconocidos
enum UserRole {
  ADMIN
  MODERATOR
  USER
  GUEST      # Nuevo rol
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>NO Cambiar Tipos de Retorno:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-graphql" data-lang="graphql"># ❌ NO HACER - Rompe clientes
type Query {
  # Antes
  user(id: ID!): User

  # Después (INCORRECTO)
  user(id: ID!): String   # Cambiar tipo rompe todo
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>NO Eliminar Campos Required:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-graphql" data-lang="graphql"># ❌ NO HACER - Clientes esperan el campo
type User {
  id: ID!
  # Antes: email: String!
  # Después: (eliminado)
}</code></pre>
</div>
</div>
<hr>
<div class="paragraph">
<p><strong>Documentación de Esquemas</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-graphql" data-lang="graphql">"""
Representa un usuario en el sistema.
Cada usuario puede crear posts y comentarios.
"""
type User {
  """El identificador único del usuario"""
  id: ID!

  """El nombre completo del usuario"""
  name: String!

  """La dirección de correo electrónico del usuario"""
  email: String!

  """Los posts creados por este usuario"""
  posts: [Post!]!

  """La fecha de creación de la cuenta"""
  createdAt: String!
}

"""
Buscar usuarios por nombre o email
"""
type Query {
  """
  Obtener un usuario por su ID

  Argumentos:
  - id: El ID único del usuario
  """
  user(id: ID!): User

  """
  Buscar usuarios

  Argumentos:
  - query: Término de búsqueda
  - limit: Máximo de resultados (default: 10)
  """
  searchUsers(query: String!, limit: Int): [User!]!
}</code></pre>
</div>
</div>
<hr>
<div class="paragraph">
<p><strong>Checklist de Buenas Prácticas:</strong></p>
</div>
<div class="paragraph">
<p>✅ Nombres claros y descriptivos
✅ Documentación completa
✅ Tipos nullable cuando sea apropiado
✅ Enums para valores limitados
✅ Input Types para argumentos complejos
✅ Interfaces para reutilizar campos
✅ Modularización lógica
✅ Versionado pensado
✅ Evolución sin romper cambios
✅ Validación en resolvers
---</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_módulo_3_queries_8_horas">MÓDULO 3: Queries (8 horas)</h3>
<div class="sect3">
<h4 id="_3_1_fundamentos_de_queries">3.1 Fundamentos de Queries</h4>
<div class="paragraph">
<p><strong>Sintaxis Básica de Queries</strong></p>
</div>
<div class="paragraph">
<p>Una query es la forma más básica de obtener datos en GraphQL.</p>
</div>
<div class="paragraph">
<p><strong>Query Mínima:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-graphql" data-lang="graphql">query {
  users {
    id
    name
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Esta query:
1. Pide el campo <code>users</code> (del tipo Query)
2. Especifica los campos que quiere: <code>id</code> y <code>name</code>
3. Retorna una lista de usuarios con solo esos dos campos</p>
</div>
<div class="paragraph">
<p><strong>Respuesta:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "data": {
    "users": [
      { "id": "1", "name": "Juan" },
      { "id": "2", "name": "María" }
    ]
  }
}</code></pre>
</div>
</div>
<hr>
<div class="paragraph">
<p><strong>Selección de Campos</strong></p>
</div>
<div class="paragraph">
<p>La selección de campos define exactamente qué datos necesitas.</p>
</div>
<div class="paragraph">
<p><strong>Ejemplo: Blog API</strong></p>
</div>
<div class="paragraph">
<p>Schema:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-graphql" data-lang="graphql">type User {
  id: ID!
  name: String!
  email: String!
  phone: String
  address: String
  posts: [Post!]!
}

type Post {
  id: ID!
  title: String!
  content: String!
  author: User!
}

type Query {
  user(id: ID!): User
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Query con selección específica:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-graphql" data-lang="graphql">query {
  user(id: "1") {
    name
    email
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Respuesta:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "data": {
    "user": {
      "name": "Juan",
      "email": "juan@example.com"
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Ventaja:</strong> Solo se retornan <code>name</code> y <code>email</code>, no <code>phone</code>, <code>address</code> ni <code>posts</code>.</p>
</div>
<hr>
<div class="paragraph">
<p><strong>Queries Anidadas</strong></p>
</div>
<div class="paragraph">
<p>Puedes seleccionar campos de tipos anidados.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-graphql" data-lang="graphql">query {
  user(id: "1") {
    name
    posts {
      title
      content
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Respuesta:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "data": {
    "user": {
      "name": "Juan",
      "posts": [
        {
          "title": "GraphQL Fundamentos",
          "content": "Aprende GraphQL..."
        },
        {
          "title": "GraphQL Avanzado",
          "content": "Patrones avanzados..."
        }
      ]
    }
  }
}</code></pre>
</div>
</div>
<hr>
<div class="paragraph">
<p><strong>Variables en Queries</strong></p>
</div>
<div class="paragraph">
<p>Las variables permiten <strong>parametrizar</strong> queries de forma dinámica.</p>
</div>
<div class="paragraph">
<p><strong>Sin Variables (No recomendado):</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-graphql" data-lang="graphql">query {
  user(id: "1") {
    name
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Tienes que cambiar el string "1" manualmente cada vez.</p>
</div>
<div class="paragraph">
<p><strong>Con Variables (Recomendado):</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-graphql" data-lang="graphql">query GetUser($userId: ID!) {
  user(id: $userId) {
    name
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Variables:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "userId": "1"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Ventajas de Variables:</strong></p>
</div>
<div class="paragraph">
<p>✅ Reutilizabilidad
✅ Seguridad (previene inyección)
✅ Validación automática
✅ Mejor legibilidad
✅ Dinámicas en tiempo de ejecución</p>
</div>
<div class="paragraph">
<p><strong>Ejemplo Completo con Múltiples Variables:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-graphql" data-lang="graphql">query GetUserPosts($userId: ID!, $limit: Int!, $offset: Int!) {
  user(id: $userId) {
    name
    email
    posts(limit: $limit, offset: $offset) {
      title
      createdAt
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Variables:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "userId": "1",
  "limit": 10,
  "offset": 0
}</code></pre>
</div>
</div>
<hr>
<div class="paragraph">
<p><strong>Aliases</strong></p>
</div>
<div class="paragraph">
<p>Los aliases permiten <strong>renombrar</strong> campos en la respuesta.</p>
</div>
<div class="paragraph">
<p><strong>Caso de Uso: Obtener múltiples usuarios</strong></p>
</div>
<div class="paragraph">
<p>Sin aliases:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-graphql" data-lang="graphql">query {
  user1: user(id: "1") {
    name
  }
  user2: user(id: "2") {
    name
  }
  user3: user(id: "3") {
    name
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Respuesta:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "data": {
    "user1": { "name": "Juan" },
    "user2": { "name": "María" },
    "user3": { "name": "Carlos" }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Otro Ejemplo: Campos con Argumentos Diferentes</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-graphql" data-lang="graphql">query {
  user(id: "1") {
    currentName: name
    email
    phone
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Respuesta:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "data": {
    "user": {
      "currentName": "Juan",
      "email": "juan@example.com",
      "phone": "123456"
    }
  }
}</code></pre>
</div>
</div>
<hr>
<div class="paragraph">
<p><strong>Fragments</strong></p>
</div>
<div class="paragraph">
<p>Los fragments permiten <strong>reutilizar</strong> selecciones de campos.</p>
</div>
<div class="paragraph">
<p><strong>Uso Básico:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-graphql" data-lang="graphql">fragment UserFields on User {
  id
  name
  email
}

query {
  user(id: "1") {
    ...UserFields
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Es equivalente a:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-graphql" data-lang="graphql">query {
  user(id: "1") {
    id
    name
    email
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Múltiples Queries con Fragments:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-graphql" data-lang="graphql">fragment UserFields on User {
  id
  name
  email
  createdAt
}

query {
  user1: user(id: "1") {
    ...UserFields
  }
  user2: user(id: "2") {
    ...UserFields
  }
  user3: user(id: "3") {
    ...UserFields
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Fragments Anidados:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-graphql" data-lang="graphql">fragment PostDetails on Post {
  id
  title
  content
  createdAt
}

fragment UserWithPosts on User {
  id
  name
  email
  posts {
    ...PostDetails
  }
}

query {
  user(id: "1") {
    ...UserWithPosts
  }
}</code></pre>
</div>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="_3_2_operaciones_avanzadas_en_queries">3.2 Operaciones Avanzadas en Queries</h4>
<div class="paragraph">
<p><strong>Argumentos</strong></p>
</div>
<div class="paragraph">
<p>Los argumentos permiten <strong>filtrar, paginar y ordenar</strong> datos.</p>
</div>
<div class="paragraph">
<p><strong>Argumentos de Filtrado:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-graphql" data-lang="graphql">type Query {
  users(role: UserRole): [User!]!
  posts(status: PostStatus): [Post!]!
  products(minPrice: Float, maxPrice: Float): [Product!]!
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Query:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-graphql" data-lang="graphql">query {
  users(role: ADMIN) {
    id
    name
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Argumentos de Paginación:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-graphql" data-lang="graphql">type Query {
  posts(limit: Int!, offset: Int!): [Post!]!
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Query:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-graphql" data-lang="graphql">query GetPosts($limit: Int!, $offset: Int!) {
  posts(limit: $limit, offset: $offset) {
    id
    title
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Variables:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "limit": 10,
  "offset": 0
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Argumentos de Búsqueda:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-graphql" data-lang="graphql">type Query {
  searchUsers(query: String!): [User!]!
  searchPosts(query: String!, limit: Int): [Post!]!
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Query:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-graphql" data-lang="graphql">query {
  searchUsers(query: "Juan") {
    id
    name
    email
  }
}</code></pre>
</div>
</div>
<hr>
<div class="paragraph">
<p><strong>Paginación</strong></p>
</div>
<div class="paragraph">
<p>La paginación es esencial para manejar grandes volúmenes de datos.</p>
</div>
<div class="paragraph">
<p><strong>Patrón Offset/Limit:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-graphql" data-lang="graphql">type Query {
  posts(limit: Int!, offset: Int!): [Post!]!
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Query - Página 1:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-graphql" data-lang="graphql">query {
  posts(limit: 10, offset: 0) {
    id
    title
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Query - Página 2:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-graphql" data-lang="graphql">query {
  posts(limit: 10, offset: 10) {
    id
    title
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Query - Página 3:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-graphql" data-lang="graphql">query {
  posts(limit: 10, offset: 20) {
    id
    title
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Patrón Cursor (más eficiente):</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-graphql" data-lang="graphql">type PostConnection {
  edges: [PostEdge!]!
  pageInfo: PageInfo!
}

type PostEdge {
  node: Post!
  cursor: String!
}

type PageInfo {
  hasNextPage: Boolean!
  hasPreviousPage: Boolean!
  startCursor: String
  endCursor: String
}

type Query {
  postsConnection(first: Int, after: String): PostConnection!
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Query:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-graphql" data-lang="graphql">query {
  postsConnection(first: 10, after: "cursor123") {
    edges {
      node {
        id
        title
      }
      cursor
    }
    pageInfo {
      hasNextPage
      endCursor
    }
  }
}</code></pre>
</div>
</div>
<hr>
<div class="paragraph">
<p><strong>Filtrado</strong></p>
</div>
<div class="paragraph">
<p>El filtrado permite obtener datos específicos.</p>
</div>
<div class="paragraph">
<p><strong>Filtrado Básico:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-graphql" data-lang="graphql">type Query {
  posts(status: PostStatus): [Post!]!
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Query:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-graphql" data-lang="graphql">query {
  posts(status: PUBLISHED) {
    id
    title
    status
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Filtrado Avanzado (Input Type):</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-graphql" data-lang="graphql">input PostFilter {
  status: PostStatus
  authorId: ID
  tags: [String!]
  createdAfter: String
  createdBefore: String
}

type Query {
  posts(filter: PostFilter): [Post!]!
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Query:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-graphql" data-lang="graphql">query {
  posts(filter: {
    status: PUBLISHED
    tags: ["graphql", "api"]
    createdAfter: "2024-01-01"
  }) {
    id
    title
    tags
  }
}</code></pre>
</div>
</div>
<hr>
<div class="paragraph">
<p><strong>Ordenamiento</strong></p>
</div>
<div class="paragraph">
<p>El ordenamiento controla el orden de los resultados.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-graphql" data-lang="graphql">enum SortOrder {
  ASC
  DESC
}

enum PostSortField {
  CREATED_AT
  UPDATED_AT
  TITLE
}

type Query {
  posts(
    sortBy: PostSortField
    sortOrder: SortOrder
  ): [Post!]!
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Query:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-graphql" data-lang="graphql">query {
  posts(sortBy: CREATED_AT, sortOrder: DESC) {
    id
    title
    createdAt
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Múltiples Ordenamientos:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-graphql" data-lang="graphql">input SortInput {
  field: String!
  order: SortOrder!
}

type Query {
  posts(sorts: [SortInput!]): [Post!]!
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Query:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-graphql" data-lang="graphql">query {
  posts(sorts: [
    { field: "status", order: ASC }
    { field: "createdAt", order: DESC }
  ]) {
    id
    title
    status
    createdAt
  }
}</code></pre>
</div>
</div>
<hr>
<div class="paragraph">
<p><strong>Introspection</strong></p>
</div>
<div class="paragraph">
<p>Introspection permite <strong>consultar el schema</strong> mismo.</p>
</div>
<div class="paragraph">
<p><strong>Obtener Todos los Tipos:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-graphql" data-lang="graphql">query {
  __schema {
    types {
      name
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Respuesta:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "data": {
    "__schema": {
      "types": [
        { "name": "String" },
        { "name": "Int" },
        { "name": "User" },
        { "name": "Post" },
        ...
      ]
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Obtener Detalles de un Tipo:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-graphql" data-lang="graphql">query {
  __type(name: "User") {
    name
    fields {
      name
      type {
        name
        kind
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Respuesta:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "data": {
    "__type": {
      "name": "User",
      "fields": [
        {
          "name": "id",
          "type": { "name": "ID", "kind": "SCALAR" }
        },
        {
          "name": "name",
          "type": { "name": "String", "kind": "SCALAR" }
        },
        {
          "name": "posts",
          "type": { "name": "Post", "kind": "OBJECT" }
        }
      ]
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Obtener Schema Completo:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-graphql" data-lang="graphql">query IntrospectionQuery {
  __schema {
    types {
      name
      kind
      fields {
        name
        type {
          name
          kind
          ofType {
            name
          }
        }
      }
    }
  }
}</code></pre>
</div>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="_3_3_optimización_de_queries">3.3 Optimización de Queries</h4>
<div class="paragraph">
<p><strong>Query Complexity</strong></p>
</div>
<div class="paragraph">
<p>La complejidad de queries es un indicador de costo computacional.</p>
</div>
<div class="paragraph">
<p><strong>Cálculo Básico de Complejidad:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-graphql" data-lang="graphql"># Complejidad: 1 (simple)
query {
  user(id: "1") {
    name
  }
}

# Complejidad: 2 (un nivel anidado)
query {
  user(id: "1") {
    name
    posts {
      title
    }
  }
}

# Complejidad: 3 (dos niveles anidados)
query {
  user(id: "1") {
    posts {
      comments {
        text
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Limitar Complejidad de Queries:</strong></p>
</div>
<div class="paragraph">
<p>En el servidor (pseudocódigo):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const query = parse(queryString);
const complexity = calculateComplexity(query, schema);

if (complexity &gt; MAX_COMPLEXITY) {
  throw new Error(`Query demasiado compleja: ${complexity}/${MAX_COMPLEXITY}`);
}

// Ejecutar query
const result = await execute(schema, query);</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Depth Limiting</strong></p>
</div>
<div class="paragraph">
<p>Limitar la profundidad máxima de anidamiento.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-graphql" data-lang="graphql"># Profundidad: 0
query {
  users { id }
}

# Profundidad: 1
query {
  users {
    posts { id }
  }
}

# Profundidad: 2
query {
  users {
    posts {
      comments { id }
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Configuración en servidor:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const maxDepth = 3;
if (calculateDepth(query) &gt; maxDepth) {
  throw new Error(`Query demasiado profunda`);
}</code></pre>
</div>
</div>
<hr>
<div class="paragraph">
<p><strong>Caching de Resultados</strong></p>
</div>
<div class="paragraph">
<p>El caching mejora el rendimiento significativamente.</p>
</div>
<div class="paragraph">
<p><strong>HTTP Caching:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">// En el servidor
response.setHeader('Cache-Control', 'public, max-age=300');</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Cache en Cliente (Apollo Client):</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const cache = new InMemoryCache();

const client = new ApolloClient({
  cache,
  link: new HttpLink({ uri: 'http://localhost:4000/graphql' })
});

// Los resultados se cachean automáticamente
const { data } = await client.query({
  query: GET_USER_QUERY,
  variables: { id: '1' }
});

// La próxima query idéntica usa el cache
const { data: cachedData } = await client.query({
  query: GET_USER_QUERY,
  variables: { id: '1' }
});</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Cache Personalizado:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const cache = new InMemoryCache({
  typePolicies: {
    User: {
      fields: {
        posts: {
          merge(existing, incoming) {
            return incoming;
          }
        }
      }
    }
  }
});</code></pre>
</div>
</div>
<hr>
<div class="paragraph">
<p><strong>DataLoader - Batch Loading</strong></p>
</div>
<div class="paragraph">
<p>DataLoader resuelve el problema N+1 queries.</p>
</div>
<div class="paragraph">
<p><strong>El Problema N+1:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-graphql" data-lang="graphql">query {
  users {
    id
    name
    posts {
      title
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Sin batch loading:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>1. Query: SELECT * FROM users          (1 query)
2. Para cada usuario:
   - Query: SELECT * FROM posts WHERE userId = 1  (N queries)
   - Query: SELECT * FROM posts WHERE userId = 2
   - ...
Total: 1 + N queries</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Con DataLoader (Solución):</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const DataLoader = require('dataloader');

const postLoader = new DataLoader(async (userIds) =&gt; {
  // userIds = [1, 2, 3, ...]

  // Una sola query por todos los usuarios
  const posts = await db.query(
    'SELECT * FROM posts WHERE userId IN (?)',
    [userIds]
  );

  // Agrupar resultados
  const groupedPosts = userIds.map(userId =&gt;
    posts.filter(post =&gt; post.userId === userId)
  );

  return groupedPosts;
});

const resolvers = {
  Query: {
    users: () =&gt; db.query('SELECT * FROM users')
  },
  User: {
    posts: (parent) =&gt; postLoader.load(parent.id)
  }
};</code></pre>
</div>
</div>
<div class="paragraph">
<p>Resultado:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>1. Query: SELECT * FROM users                 (1 query)
2. Query: SELECT * FROM posts WHERE userId IN (1,2,3,...) (1 query)
Total: 2 queries (en lugar de 1 + N)</code></pre>
</div>
</div>
<hr>
<div class="paragraph">
<p><strong>Batch Loading Pattern</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const userLoader = new DataLoader(async (userIds) =&gt; {
  const users = await db.query(
    'SELECT * FROM users WHERE id IN (?)',
    [userIds]
  );

  // Retornar en el mismo orden que userIds
  return userIds.map(id =&gt; users.find(u =&gt; u.id === id));
});

const commentLoader = new DataLoader(async (postIds) =&gt; {
  const comments = await db.query(
    'SELECT * FROM comments WHERE postId IN (?)',
    [postIds]
  );

  return postIds.map(id =&gt;
    comments.filter(c =&gt; c.postId === id)
  );
});

const resolvers = {
  Query: {
    user: (_, args) =&gt; userLoader.load(args.id)
  },
  User: {
    comments: (user) =&gt; commentLoader.load(user.id)
  }
};</code></pre>
</div>
</div>
<hr>
<div class="paragraph">
<p><strong>Buenas Prácticas para Query Performance:</strong></p>
</div>
<div class="paragraph">
<p>✅ Usar variables en lugar de strings hardcoded
✅ Especificar solo los campos necesarios
✅ Usar fragments para reutilizar selecciones
✅ Implementar paginación
✅ Usar DataLoader para batch loading
✅ Limitar profundidad y complejidad
✅ Implementar caching apropiado
✅ Monitorear y optimizar queries lentas
✅ Usar índices en la BD
✅ Profiling regular de queries</p>
</div>
<hr>
</div>
</div>
<div class="sect2">
<h3 id="_módulo_4_mutations_y_subscriptions_6_horas">MÓDULO 4: Mutations y Subscriptions (6 horas)</h3>
<div class="sect3">
<h4 id="_4_1_mutaciones">4.1 Mutaciones</h4>
<div class="paragraph">
<p><strong>¿Qué es una Mutación?</strong></p>
</div>
<div class="paragraph">
<p>Una Mutation es una <strong>operación que modifica datos</strong> en el servidor. Es la contraparte de Query para escribir datos.</p>
</div>
<div class="paragraph">
<p><strong>Diferencias Queries vs Mutations:</strong></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Query</th>
<th class="tableblock halign-left valign-top">Mutation</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Leer datos</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Modificar datos</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sin efectos secundarios</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Con efectos secundarios</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Segura</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Requiere validación</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cacheable</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No cacheable</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Idempotente</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No idempotente</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Sintaxis Básica de una Mutation:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-graphql" data-lang="graphql">mutation {
  createUser(name: "Juan", email: "juan@example.com") {
    id
    name
    email
    createdAt
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Respuesta:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "data": {
    "createUser": {
      "id": "1",
      "name": "Juan",
      "email": "juan@example.com",
      "createdAt": "2024-01-15T10:30:00Z"
    }
  }
}</code></pre>
</div>
</div>
<hr>
<div class="paragraph">
<p><strong>Diseño de Mutaciones</strong></p>
</div>
<div class="paragraph">
<p><strong>Convenciones de Nomenclatura:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-graphql" data-lang="graphql">type Mutation {
  # Crear
  createUser(input: CreateUserInput!): User!
  createPost(input: CreatePostInput!): Post!

  # Actualizar
  updateUser(id: ID!, input: UpdateUserInput!): User
  updatePost(id: ID!, input: UpdatePostInput!): Post

  # Eliminar
  deleteUser(id: ID!): Boolean!
  deletePost(id: ID!): Boolean!

  # Acciones específicas
  publishPost(id: ID!): Post
  archivePost(id: ID!): Post
  likePost(id: ID!): Post
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Estructura de Input Types:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-graphql" data-lang="graphql">input CreateUserInput {
  name: String!
  email: String!
  password: String!
}

input UpdateUserInput {
  name: String
  email: String
  bio: String
}

input CreatePostInput {
  title: String!
  content: String!
  tags: [String!]
  publish: Boolean
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Tipos de Retorno:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-graphql" data-lang="graphql"># Retornar el objeto creado/actualizado
type Mutation {
  createUser(input: CreateUserInput!): User!
}

# Retornar booleano para operaciones simples
type Mutation {
  deleteUser(id: ID!): Boolean!
}

# Retornar tipo de respuesta personalizado
type UserPayload {
  user: User
  success: Boolean!
  message: String
}

type Mutation {
  createUser(input: CreateUserInput!): UserPayload!
}</code></pre>
</div>
</div>
<hr>
<div class="paragraph">
<p><strong>Validación en Mutaciones</strong></p>
</div>
<div class="paragraph">
<p><strong>Validación en Schema:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-graphql" data-lang="graphql">input CreateUserInput {
  # Email requerido
  email: String!
  # Edad entre 18 y 120
  age: Int
  # Contraseña mínimo 8 caracteres
  password: String!
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Validación en Resolver:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const resolvers = {
  Mutation: {
    createUser: async (_, { input }) =&gt; {
      // Validar email
      if (!isValidEmail(input.email)) {
        throw new Error('Email inválido');
      }

      // Validar que el email no exista
      const existingUser = await db.users.findByEmail(input.email);
      if (existingUser) {
        throw new Error('Email ya registrado');
      }

      // Validar contraseña
      if (input.password.length &lt; 8) {
        throw new Error('Contraseña debe tener mínimo 8 caracteres');
      }

      // Crear usuario
      const user = await db.users.create({
        ...input,
        password: await hashPassword(input.password)
      });

      return user;
    }
  }
};</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Validación Reutilizable:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">// validators.js
export const validators = {
  email: (value) =&gt; {
    const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    if (!re.test(value)) throw new Error('Email inválido');
  },

  password: (value) =&gt; {
    if (value.length &lt; 8) throw new Error('Mínimo 8 caracteres');
    if (!value.match(/[0-9]/)) throw new Error('Debe contener números');
    if (!value.match(/[A-Z]/)) throw new Error('Debe contener mayúsculas');
  },

  age: (value) =&gt; {
    if (value &lt; 18 || value &gt; 120) throw new Error('Edad inválida');
  }
};

// Usar en resolvers
const resolvers = {
  Mutation: {
    createUser: async (_, { input }) =&gt; {
      validators.email(input.email);
      validators.password(input.password);
      if (input.age) validators.age(input.age);

      // Crear usuario...
    }
  }
};</code></pre>
</div>
</div>
<hr>
<div class="paragraph">
<p><strong>Manejo de Errores en Mutaciones</strong></p>
</div>
<div class="paragraph">
<p><strong>Errores Estructurados:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-graphql" data-lang="graphql">type UserPayload {
  user: User
  success: Boolean!
  errors: [UserError!]
}

type UserError {
  field: String!
  message: String!
}

type Mutation {
  createUser(input: CreateUserInput!): UserPayload!
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Respuesta con errores:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "data": {
    "createUser": {
      "user": null,
      "success": false,
      "errors": [
        {
          "field": "email",
          "message": "Email ya registrado"
        },
        {
          "field": "password",
          "message": "Contraseña muy débil"
        }
      ]
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Errores GraphQL Estándar:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const resolvers = {
  Mutation: {
    createUser: async (_, { input }) =&gt; {
      // Lanzar error directamente
      if (!input.email) {
        throw new Error('Email es requerido');
      }

      try {
        const user = await db.users.create(input);
        return user;
      } catch (error) {
        throw new Error(`No se pudo crear usuario: ${error.message}`);
      }
    }
  }
};</code></pre>
</div>
</div>
<div class="paragraph">
<p>Respuesta:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "data": null,
  "errors": [
    {
      "message": "Email es requerido",
      "locations": [{ "line": 2, "column": 3 }],
      "path": ["createUser"]
    }
  ]
}</code></pre>
</div>
</div>
<hr>
<div class="paragraph">
<p><strong>CRUD Completo</strong></p>
</div>
<div class="paragraph">
<p><strong>Schema:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-graphql" data-lang="graphql">input CreatePostInput {
  title: String!
  content: String!
  tags: [String!]
}

input UpdatePostInput {
  title: String
  content: String
  tags: [String!]
}

type PostPayload {
  post: Post
  success: Boolean!
  message: String
}

type Mutation {
  # Create
  createPost(input: CreatePostInput!): PostPayload!

  # Read (en Query)
  # Read se hace en Query, no en Mutation

  # Update
  updatePost(id: ID!, input: UpdatePostInput!): PostPayload!

  # Delete
  deletePost(id: ID!): PostPayload!
}

type Query {
  post(id: ID!): Post
  posts(limit: Int, offset: Int): [Post!]!
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Resolvers:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const resolvers = {
  Query: {
    post: async (_, { id }) =&gt; {
      return await db.posts.findById(id);
    },

    posts: async (_, { limit = 10, offset = 0 }) =&gt; {
      return await db.posts.find({}, { limit, offset });
    }
  },

  Mutation: {
    // CREATE
    createPost: async (_, { input }, { userId }) =&gt; {
      try {
        // Validar
        if (!input.title?.trim()) {
          return {
            post: null,
            success: false,
            message: 'Título es requerido'
          };
        }

        if (input.title.length &gt; 200) {
          return {
            post: null,
            success: false,
            message: 'Título máximo 200 caracteres'
          };
        }

        // Crear
        const post = await db.posts.create({
          ...input,
          authorId: userId,
          createdAt: new Date()
        });

        return {
          post,
          success: true,
          message: 'Post creado exitosamente'
        };
      } catch (error) {
        return {
          post: null,
          success: false,
          message: `Error: ${error.message}`
        };
      }
    },

    // UPDATE
    updatePost: async (_, { id, input }, { userId }) =&gt; {
      try {
        // Obtener post actual
        const post = await db.posts.findById(id);

        if (!post) {
          return {
            post: null,
            success: false,
            message: 'Post no encontrado'
          };
        }

        // Validar permisos
        if (post.authorId !== userId) {
          return {
            post: null,
            success: false,
            message: 'No tienes permiso para editar este post'
          };
        }

        // Actualizar
        const updated = await db.posts.update(id, {
          ...input,
          updatedAt: new Date()
        });

        return {
          post: updated,
          success: true,
          message: 'Post actualizado exitosamente'
        };
      } catch (error) {
        return {
          post: null,
          success: false,
          message: `Error: ${error.message}`
        };
      }
    },

    // DELETE
    deletePost: async (_, { id }, { userId }) =&gt; {
      try {
        const post = await db.posts.findById(id);

        if (!post) {
          return {
            post: null,
            success: false,
            message: 'Post no encontrado'
          };
        }

        if (post.authorId !== userId) {
          return {
            post: null,
            success: false,
            message: 'No tienes permiso para eliminar este post'
          };
        }

        await db.posts.delete(id);

        return {
          post,
          success: true,
          message: 'Post eliminado exitosamente'
        };
      } catch (error) {
        return {
          post: null,
          success: false,
          message: `Error: ${error.message}`
        };
      }
    }
  }
};</code></pre>
</div>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="_4_2_subscriptions">4.2 Subscriptions</h4>
<div class="paragraph">
<p><strong>¿Qué es una Subscription?</strong></p>
</div>
<div class="paragraph">
<p>Una Subscription es una <strong>conexión bidireccional</strong> que permite al servidor <strong>enviar datos al cliente en tiempo real</strong>.</p>
</div>
<div class="paragraph">
<p><strong>Queries vs Mutations vs Subscriptions:</strong></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Aspecto</th>
<th class="tableblock halign-left valign-top">Query</th>
<th class="tableblock halign-left valign-top">Mutation</th>
<th class="tableblock halign-left valign-top">Subscription</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Propósito</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Leer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Escribir</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cambios en vivo</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Conexión</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTTP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTTP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">WebSocket</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Duración</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Una vez</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Una vez</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Permanente</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Flujo</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cliente → Servidor</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cliente → Servidor</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bidireccional</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ejemplo</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Obtener usuario</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Crear post</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Notificación de nuevo post</p></td>
</tr>
</tbody>
</table>
<hr>
<div class="paragraph">
<p><strong>WebSockets en GraphQL</strong></p>
</div>
<div class="paragraph">
<p>GraphQL usa WebSockets para mantener conexiones permanentes.</p>
</div>
<div class="paragraph">
<p><strong>Flujo de Conexión:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>Cliente                           Servidor
   │                               │
   ├──────Connection Init────────→│
   │                               │
   │←──────Connection Ack─────────┤
   │                               │
   ├──────Subscribe────────────────→│
   │  (userCreated)                 │
   │                               │
   │←──────Next (user data)────────┤ (Evento 1)
   │                               │
   │←──────Next (user data)────────┤ (Evento 2)
   │                               │
   │                               │
   │←──────Next (user data)────────┤ (Evento N)
   │                               │
   ├──────Unsubscribe──────────────→│
   │                               │
   │←──────Complete─────────────────┤
   │                               │</code></pre>
</div>
</div>
<hr>
<div class="paragraph">
<p><strong>Sintaxis de Subscriptions</strong></p>
</div>
<div class="paragraph">
<p><strong>Definición en Schema:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-graphql" data-lang="graphql">type Subscription {
  # Notificación cuando se crea un usuario
  userCreated: User!

  # Notificación con argumentos
  postCreated(authorId: ID): Post!

  # Notificación de mensajes
  messageReceived(userId: ID!): Message!

  # Notificación de cambios
  userUpdated(id: ID!): User!
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Subscription en Cliente:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-graphql" data-lang="graphql">subscription OnUserCreated {
  userCreated {
    id
    name
    email
    createdAt
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Cada vez que se crea un usuario, el cliente recibe:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "data": {
    "userCreated": {
      "id": "123",
      "name": "Juan",
      "email": "juan@example.com",
      "createdAt": "2024-01-15T10:30:00Z"
    }
  }
}</code></pre>
</div>
</div>
<hr>
<div class="paragraph">
<p><strong>Pub/Sub Pattern</strong></p>
</div>
<div class="paragraph">
<p>GraphQL Subscriptions usa <strong>Pub/Sub (Publish/Subscribe)</strong> para notificaciones.</p>
</div>
<div class="paragraph">
<p><strong>Concepto Básico:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>Mutation (createUser)  → Publish "USER_CREATED"  → Subscribers reciben notificación
                                                  → Subscription (userCreated)
                                                  → Enviar a Cliente</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Implementación con Apollo Server:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const { PubSub } = require('apollo-server');

const pubsub = new PubSub();

const USER_CREATED = 'USER_CREATED';
const POST_CREATED = 'POST_CREATED';
const MESSAGE_RECEIVED = 'MESSAGE_RECEIVED';

const resolvers = {
  Mutation: {
    createUser: async (_, { input }) =&gt; {
      // Crear usuario
      const user = await db.users.create(input);

      // Publicar evento
      pubsub.publish(USER_CREATED, { userCreated: user });

      return user;
    },

    createPost: async (_, { input }, { userId }) =&gt; {
      const post = await db.posts.create({
        ...input,
        authorId: userId
      });

      // Publicar evento
      pubsub.publish(POST_CREATED, { postCreated: post });

      return post;
    },

    sendMessage: async (_, { input }, { userId }) =&gt; {
      const message = await db.messages.create({
        ...input,
        senderId: userId
      });

      // Publicar a destinatario específico
      pubsub.publish(MESSAGE_RECEIVED, {
        messageReceived: message
      });

      return message;
    }
  },

  Subscription: {
    userCreated: {
      subscribe: () =&gt; pubsub.asyncIterator([USER_CREATED])
    },

    postCreated: {
      subscribe: (_, { authorId }) =&gt; {
        if (authorId) {
          // Filtrar posts del autor específico
          return pubsub.asyncIterator([POST_CREATED]);
        }
        return pubsub.asyncIterator([POST_CREATED]);
      }
    },

    messageReceived: {
      subscribe: (_, { userId }) =&gt; {
        // Solo suscribirse a mensajes del usuario específico
        return pubsub.asyncIterator([MESSAGE_RECEIVED]);
      }
    }
  }
};</code></pre>
</div>
</div>
<hr>
<div class="paragraph">
<p><strong>Casos de Uso de Subscriptions</strong></p>
</div>
<div class="paragraph">
<p><strong>1. Notificaciones en Tiempo Real:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-graphql" data-lang="graphql">type Subscription {
  orderStatusChanged(orderId: ID!): Order!
  shipmentTracking(shipmentId: ID!): Shipment!
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>2. Chat en Tiempo Real:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-graphql" data-lang="graphql">type Subscription {
  messageReceived(conversationId: ID!): Message!
  userTyping(conversationId: ID!): TypingNotification!
}

type TypingNotification {
  userId: ID!
  conversationId: ID!
  isTyping: Boolean!
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>3. Actualizaciones Colaborativas:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-graphql" data-lang="graphql">type Subscription {
  documentUpdated(documentId: ID!): Document!
  collaboratorPresence(documentId: ID!): Collaborator!
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>4. Datos en Vivo:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-graphql" data-lang="graphql">type Subscription {
  priceUpdated(ticker: String!): StockPrice!
  weatherUpdated(location: String!): Weather!
  countdownTick(eventId: ID!): Countdown!
}</code></pre>
</div>
</div>
<hr>
<div class="paragraph">
<p><strong>Ciclo de Vida de una Subscription</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const resolvers = {
  Subscription: {
    messageReceived: {
      // 1. SETUP - Cuando cliente se suscribe
      subscribe: async (_, { userId }, { db }) =&gt; {
        console.log(`Usuario ${userId} suscrito a mensajes`);

        // Validar que el usuario existe
        const user = await db.users.findById(userId);
        if (!user) throw new Error('Usuario no encontrado');

        // Retornar async iterator
        return pubsub.asyncIterator([MESSAGE_RECEIVED]);
      },

      // 2. FILTER - Filtrar eventos relevantes
      filter: (payload, variables) =&gt; {
        // Solo enviar si el mensaje es para el usuario
        return payload.messageReceived.recipientId === variables.userId;
      },

      // 3. RESOLVE - Procesar datos antes de enviar
      resolve: (payload, variables, { user }) =&gt; {
        // Enriquecer datos
        return {
          ...payload.messageReceived,
          readBy: user.id,
          readAt: new Date()
        };
      }
    }
  }
};</code></pre>
</div>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="_4_3_error_handling_y_validación">4.3 Error Handling y Validación</h4>
<div class="paragraph">
<p><strong>Tipos de Errores en GraphQL</strong></p>
</div>
<div class="paragraph">
<p><strong>1. Errores de Validación (Antes de ejecutar):</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-graphql" data-lang="graphql">query GetUser($id: ID!) {
  user(id: $id) {
    name
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Variables:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "id": "123"  # OK - coincide con tipo ID!
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Con error de validación:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "id": 123   # ERROR - número en lugar de string
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Respuesta:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "errors": [
    {
      "message": "Variable $id de tipo ID! no fue proporcionada.",
      "extensions": {
        "code": "GRAPHQL_VALIDATION_FAILED"
      }
    }
  ]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>2. Errores de Ejecución (Durante la resolución):</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const resolvers = {
  Query: {
    user: async (_, { id }) =&gt; {
      try {
        const user = await db.users.findById(id);
        if (!user) throw new Error('Usuario no encontrado');
        return user;
      } catch (error) {
        throw new Error(`Error al obtener usuario: ${error.message}`);
      }
    }
  }
};</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>3. Errores de Formato:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-graphql" data-lang="graphql">mutation {
  createPost(title: "Test") {
    id
    title
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Errores de formato GraphQL:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "errors": [
    {
      "message": "Syntax Error: Expected Name, found }",
      "locations": [{ "line": 2, "column": 28 }]
    }
  ]
}</code></pre>
</div>
</div>
<hr>
<div class="paragraph">
<p><strong>Error Handling Pattern</strong></p>
</div>
<div class="paragraph">
<p><strong>Estructura de Respuesta Segura:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-graphql" data-lang="graphql">type Mutation {
  createUser(input: CreateUserInput!): CreateUserPayload!
}

type CreateUserPayload {
  user: User
  success: Boolean!
  errors: [Error!]
}

type Error {
  code: String!
  message: String!
  field: String
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Implementación:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const resolvers = {
  Mutation: {
    createUser: async (_, { input }) =&gt; {
      const errors = [];

      // Validación
      if (!input.email) {
        errors.push({
          code: 'MISSING_EMAIL',
          message: 'Email es requerido',
          field: 'email'
        });
      }

      if (!isValidEmail(input.email)) {
        errors.push({
          code: 'INVALID_EMAIL',
          message: 'Formato de email inválido',
          field: 'email'
        });
      }

      if (input.password.length &lt; 8) {
        errors.push({
          code: 'WEAK_PASSWORD',
          message: 'Contraseña muy débil',
          field: 'password'
        });
      }

      // Si hay errores, retornar sin crear
      if (errors.length &gt; 0) {
        return {
          user: null,
          success: false,
          errors
        };
      }

      // Crear usuario
      try {
        const user = await db.users.create(input);
        return {
          user,
          success: true,
          errors: []
        };
      } catch (error) {
        return {
          user: null,
          success: false,
          errors: [
            {
              code: 'DATABASE_ERROR',
              message: error.message
            }
          ]
        };
      }
    }
  }
};</code></pre>
</div>
</div>
<hr>
<div class="paragraph">
<p><strong>Validación de Input</strong></p>
</div>
<div class="paragraph">
<p><strong>Validadores Reutilizables:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">// validators.js
class ValidationError extends Error {
  constructor(field, message) {
    super(message);
    this.field = field;
  }
}

const validators = {
  email: (value) =&gt; {
    if (!value) throw new ValidationError('email', 'Email requerido');
    const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    if (!re.test(value)) {
      throw new ValidationError('email', 'Email inválido');
    }
  },

  password: (value) =&gt; {
    if (!value) throw new ValidationError('password', 'Contraseña requerida');
    if (value.length &lt; 8) {
      throw new ValidationError('password', 'Mínimo 8 caracteres');
    }
    if (!value.match(/[0-9]/)) {
      throw new ValidationError('password', 'Debe contener números');
    }
    if (!value.match(/[A-Z]/)) {
      throw new ValidationError('password', 'Debe contener mayúsculas');
    }
  },

  username: (value) =&gt; {
    if (!value) throw new ValidationError('username', 'Usuario requerido');
    if (value.length &lt; 3) {
      throw new ValidationError('username', 'Mínimo 3 caracteres');
    }
    if (!/^[a-zA-Z0-9_]+$/.test(value)) {
      throw new ValidationError('username', 'Solo letras, números y guiones bajos');
    }
  },

  string: (value, fieldName, options = {}) =&gt; {
    if (options.required &amp;&amp; !value) {
      throw new ValidationError(fieldName, `${fieldName} es requerido`);
    }
    if (options.minLength &amp;&amp; value.length &lt; options.minLength) {
      throw new ValidationError(fieldName,
        `${fieldName} debe tener mínimo ${options.minLength} caracteres`);
    }
    if (options.maxLength &amp;&amp; value.length &gt; options.maxLength) {
      throw new ValidationError(fieldName,
        `${fieldName} debe tener máximo ${options.maxLength} caracteres`);
    }
  }
};

export { validators, ValidationError };</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Usar Validadores:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">import { validators, ValidationError } from './validators';

const resolvers = {
  Mutation: {
    createUser: async (_, { input }) =&gt; {
      const errors = [];

      try {
        validators.email(input.email);
        validators.password(input.password);
        validators.username(input.username);
        validators.string(input.bio, 'bio', { maxLength: 500 });

        // Si no hay errores, crear usuario
        const user = await db.users.create(input);
        return { user, success: true, errors: [] };

      } catch (error) {
        if (error instanceof ValidationError) {
          errors.push({
            code: error.message.toUpperCase().replace(/ /g, '_'),
            message: error.message,
            field: error.field
          });
        } else {
          errors.push({
            code: 'UNKNOWN_ERROR',
            message: error.message
          });
        }

        return { user: null, success: false, errors };
      }
    }
  }
};</code></pre>
</div>
</div>
<hr>
<div class="paragraph">
<p><strong>Error Middleware</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const createServer = () =&gt; {
  return new ApolloServer({
    typeDefs,
    resolvers,

    // Middleware para errores
    formatError: (error) =&gt; {
      console.error('GraphQL Error:', error);

      // No exponer detalles internos en producción
      if (process.env.NODE_ENV === 'production') {
        return {
          message: 'Algo salió mal',
          extensions: {
            code: 'INTERNAL_ERROR'
          }
        };
      }

      return {
        message: error.message,
        locations: error.locations,
        path: error.path,
        extensions: {
          code: error.extensions?.code || 'INTERNAL_ERROR'
        }
      };
    },

    // Plugin para logging
    plugins: {
      didResolveOperation: ({ request }) =&gt; {
        console.log(`Operation: ${request.operationName}`);
      },

      didEncounterErrors: ({ errors }) =&gt; {
        for (const error of errors) {
          console.error('Error en resolver:', error);
        }
      }
    }
  });
};</code></pre>
</div>
</div>
<hr>
<div class="paragraph">
<p><strong>Checklist de Buenas Prácticas:</strong></p>
</div>
<div class="paragraph">
<p>✅ Validar input en schema y resolver
✅ Devolver estructuras de error consistentes
✅ No exponer errores internos en producción
✅ Usar tipos específicos para errores
✅ Documentar códigos de error
✅ Loguear errores para debugging
✅ Usar Try/Catch en operaciones async
✅ Validar permisos antes de modificar datos
✅ Usar Input Types para argumentos complejos
✅ Mantener errores de validación separados de lógica</p>
</div>
<hr>
</div>
</div>
<div class="sect2">
<h3 id="_módulo_5_servidores_graphql_8_horas">MÓDULO 5: Servidores GraphQL (8 horas)</h3>
<div class="sect3">
<h4 id="_5_1_apollo_server">5.1 Apollo Server</h4>
<div class="paragraph">
<p><strong>¿Qué es Apollo Server?</strong></p>
</div>
<div class="paragraph">
<p>Apollo Server es el servidor GraphQL más popular. Es un servidor de código abierto que te permite construir APIs GraphQL con facilidad.</p>
</div>
<div class="paragraph">
<p><strong>Características Principales:</strong></p>
</div>
<div class="paragraph">
<p>✅ Fácil de configurar
✅ Soporte para múltiples fuentes de datos
✅ Middleware personalizado
✅ Debugging integrado
✅ Subscriptions (WebSockets)
✅ Federation (múltiples schemas)
✅ Plugin system
✅ Buena documentación</p>
</div>
<hr>
<div class="paragraph">
<p><strong>Instalación y Setup Básico</strong></p>
</div>
<div class="paragraph">
<p><strong>Paso 1: Instalar dependencias</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">npm install apollo-server graphql</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Paso 2: Crear servidor básico</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">// server.js
const { ApolloServer, gql } = require('apollo-server');

// 1. Definir schema
const typeDefs = gql`
  type Query {
    hello: String
    user(id: ID!): User
  }

  type User {
    id: ID!
    name: String!
    email: String!
  }
`;

// 2. Definir resolvers
const resolvers = {
  Query: {
    hello: () =&gt; 'Hola GraphQL!',
    user: (_, { id }) =&gt; ({
      id,
      name: 'Juan',
      email: 'juan@example.com'
    })
  }
};

// 3. Crear servidor
const server = new ApolloServer({
  typeDefs,
  resolvers
});

// 4. Iniciar servidor
server.listen({ port: 4000 }).then(({ url }) =&gt; {
  console.log(`Servidor ejecutándose en ${url}`);
});</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Paso 3: Ejecutar</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">node server.js
# Servidor ejecutándose en http://localhost:4000/</code></pre>
</div>
</div>
<hr>
<div class="paragraph">
<p><strong>Resolvers</strong></p>
</div>
<div class="paragraph">
<p>Los resolvers son funciones que resuelven cada campo del schema.</p>
</div>
<div class="paragraph">
<p><strong>Estructura de un Resolver:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const resolvers = {
  Query: {
    // Resolver: (parent, args, context, info)
    user: (parent, args, context, info) =&gt; {
      // parent: el objeto padre (null en Query)
      // args: argumentos de la query
      // context: datos compartidos (BD, user, etc.)
      // info: información de la query

      return {
        id: args.id,
        name: 'Juan'
      };
    }
  }
};</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Ejemplo Completo:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const resolvers = {
  Query: {
    users: async (parent, args, { db }) =&gt; {
      // Obtener todos los usuarios
      return await db.users.find({});
    },

    user: async (parent, { id }, { db }) =&gt; {
      // Obtener usuario por ID
      return await db.users.findById(id);
    },

    searchUsers: async (parent, { query }, { db }) =&gt; {
      // Buscar usuarios
      return await db.users.find({
        $or: [
          { name: { $regex: query } },
          { email: { $regex: query } }
        ]
      });
    }
  },

  User: {
    posts: async (user, args, { db, postLoader }) =&gt; {
      // Usar DataLoader para evitar N+1
      return postLoader.load(user.id);
    },

    followerCount: async (user, args, { db }) =&gt; {
      // Contar seguidores
      return await db.users.countDocuments({
        following: user.id
      });
    }
  },

  Mutation: {
    createUser: async (parent, { input }, { db }) =&gt; {
      const user = await db.users.create(input);
      return user;
    }
  }
};</code></pre>
</div>
</div>
<hr>
<div class="paragraph">
<p><strong>Context</strong></p>
</div>
<div class="paragraph">
<p>Context es un objeto compartido entre resolvers. Se usa para pasar datos globales.</p>
</div>
<div class="paragraph">
<p><strong>Crear Context:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const server = new ApolloServer({
  typeDefs,
  resolvers,

  context: async ({ req }) =&gt; {
    // Obtener token del header
    const token = req.headers.authorization?.replace('Bearer ', '');

    // Verificar token
    let user = null;
    if (token) {
      user = await verifyToken(token);
    }

    // Retornar contexto
    return {
      user,
      db: database,
      dataloaders: {
        userLoader,
        postLoader,
        commentLoader
      }
    };
  }
});</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Usar Context en Resolvers:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const resolvers = {
  Query: {
    me: (_, args, { user }) =&gt; {
      if (!user) throw new Error('No autenticado');
      return user;
    },

    users: (_, args, { db }) =&gt; {
      return db.users.find({});
    }
  },

  Mutation: {
    createPost: async (_, { input }, { user, db }) =&gt; {
      if (!user) throw new Error('No autenticado');

      const post = await db.posts.create({
        ...input,
        authorId: user.id
      });

      return post;
    }
  }
};</code></pre>
</div>
</div>
<hr>
<div class="paragraph">
<p><strong>Middleware</strong></p>
</div>
<div class="paragraph">
<p>El middleware permite interceptar y procesar requests.</p>
</div>
<div class="paragraph">
<p><strong>Crear Middleware:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const loggerMiddleware = async (req, res, next) =&gt; {
  console.log(`${new Date().toISOString()} - ${req.method} ${req.path}`);
  await next();
};

const authMiddleware = async (req, res, next) =&gt; {
  const token = req.headers.authorization?.replace('Bearer ', '');

  if (token) {
    try {
      req.user = await verifyToken(token);
    } catch (error) {
      console.error('Token inválido:', error);
    }
  }

  await next();
};

const server = new ApolloServer({
  typeDefs,
  resolvers,
  context: ({ req }) =&gt; ({
    user: req.user,
    db: database
  })
});</code></pre>
</div>
</div>
<hr>
<div class="paragraph">
<p><strong>Plugins de Apollo Server</strong></p>
</div>
<div class="paragraph">
<p>Los plugins permiten ejecutar código en diferentes etapas del ciclo de vida.</p>
</div>
<div class="paragraph">
<p><strong>Plugin de Logging:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const loggingPlugin = {
  // Cuando se inicia el servidor
  serverWillStart() {
    console.log('Servidor iniciando...');
  },

  // Antes de procesar la operación
  requestDidStart(requestContext) {
    const startTime = Date.now();
    const { request, context } = requestContext;

    console.log(`Operación: ${request.operationName}`);
    console.log(`Usuario: ${context.user?.id || 'Anónimo'}`);

    return {
      // Cuando ocurre un error
      didEncounterErrors(errContext) {
        for (const err of errContext.errors) {
          console.error(`Error: ${err.message}`);
        }
      },

      // Cuando termina la operación
      willSendResponse(respContext) {
        const duration = Date.now() - startTime;
        console.log(`Tiempo: ${duration}ms\n`);
      }
    };
  }
};

const server = new ApolloServer({
  typeDefs,
  resolvers,
  plugins: [loggingPlugin]
});</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Plugin de Performance:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const performancePlugin = {
  requestDidStart(requestContext) {
    const startTime = Date.now();

    return {
      didResolveField({ fieldName, returnType }) {
        const fieldStartTime = Date.now();

        return () =&gt; {
          const duration = Date.now() - fieldStartTime;
          if (duration &gt; 100) {
            console.warn(
              `Campo lento: ${fieldName} (${duration}ms)`
            );
          }
        };
      },

      willSendResponse() {
        const totalDuration = Date.now() - startTime;
        console.log(`Tiempo total: ${totalDuration}ms`);
      }
    };
  }
};</code></pre>
</div>
</div>
<hr>
<div class="paragraph">
<p><strong>Configuración Avanzada</strong></p>
</div>
<div class="paragraph">
<p><strong>Servidor con Todas las Opciones:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const server = new ApolloServer({
  typeDefs,
  resolvers,

  // Contexto
  context: async ({ req }) =&gt; ({
    user: req.user,
    db: database,
    loaders: createDataLoaders()
  }),

  // Formateo de errores
  formatError: (error) =&gt; {
    console.error('GraphQL Error:', error);

    // No exponer detalles en producción
    if (process.env.NODE_ENV === 'production') {
      return { message: 'Error interno' };
    }

    return error;
  },

  // Introspection deshabilitado en producción
  introspection: process.env.NODE_ENV !== 'production',

  // Playground deshabilitado en producción
  apollo: {
    rewriteError: (err) =&gt; {
      if (err.message.startsWith('Cannot query field')) {
        return null; // Ocultar error
      }
      return err;
    }
  },

  // Plugins
  plugins: [loggingPlugin, performancePlugin],

  // Validación de queries
  validationRules: [
    depthLimitPlugin(3),
    complexityPlugin({ maximumComplexity: 100 })
  ]
});</code></pre>
</div>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="_5_2_alternativas_a_apollo_server">5.2 Alternativas a Apollo Server</h4>
<div class="paragraph">
<p><strong>Express GraphQL</strong></p>
</div>
<div class="paragraph">
<p>Integrar GraphQL en Express existente.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const express = require('express');
const { graphqlHTTP } = require('express-graphql');
const { buildSchema } = require('graphql');

const schema = buildSchema(`
  type Query {
    hello: String
    user(id: ID!): User
  }

  type User {
    id: ID!
    name: String!
  }
`);

const resolvers = {
  hello: () =&gt; 'Hola GraphQL',
  user: ({ id }) =&gt; ({
    id,
    name: 'Juan'
  })
};

const app = express();

app.use('/graphql', graphqlHTTP({
  schema,
  rootValue: resolvers,
  graphiql: true  // Habilitar GraphiQL explorer
}));

app.listen(4000, () =&gt; {
  console.log('Servidor en http://localhost:4000/graphql');
});</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Ventajas de Express GraphQL:</strong>
✅ Simple de integrar
✅ Menos overhead
✅ Flexibilidad de Express</p>
</div>
<div class="paragraph">
<p><strong>Desventajas:</strong>
⚠️ Menos features que Apollo
⚠️ Subscriptions requieren configuración extra</p>
</div>
<hr>
<div class="paragraph">
<p><strong>GraphQL Yoga</strong></p>
</div>
<div class="paragraph">
<p>Servidor moderno y flexible.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const { createServer } = require('@graphql-yoga/node');

const server = createServer({
  schema: {
    typeDefs: `
      type Query {
        hello: String
      }
    `,
    resolvers: {
      Query: {
        hello: () =&gt; 'Hola Yoga!'
      }
    }
  }
});

server.listen(4000, () =&gt; {
  console.log('Servidor en http://localhost:4000');
});</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Características:</strong>
✅ Basado en Fetch API
✅ Soporte nativo para Edge (Cloudflare, Vercel)
✅ WebSockets por defecto
✅ Muy rápido y ligero</p>
</div>
<hr>
<div class="paragraph">
<p><strong>Graphene (Python)</strong></p>
</div>
<div class="paragraph">
<p>Para aplicaciones Python.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">import graphene

class User(graphene.ObjectType):
    id = graphene.ID()
    name = graphene.String()
    email = graphene.String()

class Query(graphene.ObjectType):
    user = graphene.Field(User, id=graphene.ID(required=True))

    def resolve_user(self, info, id):
        return User(id=id, name='Juan', email='juan@example.com')

schema = graphene.Schema(query=Query)

# Ejecutar query
query = '''
    query {
        user(id: "1") {
            id
            name
            email
        }
    }
'''

result = schema.execute(query)
print(result.data)</code></pre>
</div>
</div>
<hr>
<div class="paragraph">
<p><strong>Juniper (Rust)</strong></p>
</div>
<div class="paragraph">
<p>Para aplicaciones Rust.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-rust" data-lang="rust">use juniper::{GraphQLObject, RootNode};

#[derive(GraphQLObject)]
struct User {
    id: String,
    name: String,
    email: String,
}

pub struct QueryRoot;

#[juniper::object]
impl QueryRoot {
    fn user(id: String) -&gt; User {
        User {
            id,
            name: "Juan".to_string(),
            email: "juan@example.com".to_string(),
        }
    }
}

pub type Schema = RootNode&lt;'static, QueryRoot, EmptyMutation&lt;()&gt;&gt;;

fn main() {
    let schema = Schema::new(QueryRoot, EmptyMutation::new());

    let query = r#"
        {
            user(id: "1") {
                id
                name
                email
            }
        }
    "#;

    let result = juniper::execute_sync(query, None, &amp;schema, &amp;Variables::new(), &amp;());
    println!("{:?}", result);
}</code></pre>
</div>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="_5_3_integración_con_bases_de_datos">5.3 Integración con Bases de Datos</h4>
<div class="paragraph">
<p><strong>Patrones de Resolvers</strong></p>
</div>
<div class="paragraph">
<p><strong>Patrón 1: Resolver Simple</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const resolvers = {
  Query: {
    user: async (_, { id }, { db }) =&gt; {
      return await db.users.findById(id);
    }
  }
};</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Patrón 2: Resolver con Transformación</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const resolvers = {
  User: {
    fullName: (user) =&gt; {
      return `${user.firstName} ${user.lastName}`;
    },

    age: (user) =&gt; {
      const today = new Date();
      const birthDate = new Date(user.birthDate);
      return today.getFullYear() - birthDate.getFullYear();
    }
  }
};</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Patrón 3: Resolver con Relaciones</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const resolvers = {
  Query: {
    post: async (_, { id }, { db }) =&gt; {
      return await db.posts.findById(id);
    }
  },

  Post: {
    author: async (post, _, { db }) =&gt; {
      // Cargar autor del post
      return await db.users.findById(post.authorId);
    },

    comments: async (post, { limit = 10 }, { db }) =&gt; {
      // Cargar comentarios del post
      return await db.comments
        .find({ postId: post.id })
        .limit(limit)
        .exec();
    }
  }
};</code></pre>
</div>
</div>
<hr>
<div class="paragraph">
<p><strong>Integración con ORM (Prisma)</strong></p>
</div>
<div class="paragraph">
<p><strong>Setup:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">npm install @prisma/client
npx prisma init</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Schema Prisma (prisma/schema.prisma):</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-prisma" data-lang="prisma">datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model User {
  id    Int     @id @default(autoincrement())
  email String  @unique
  name  String
  posts Post[]
}

model Post {
  id      Int     @id @default(autoincrement())
  title   String
  content String
  author  User    @relation(fields: [authorId], references: [id])
  authorId Int
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Resolvers con Prisma:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const { PrismaClient } = require('@prisma/client');

const prisma = new PrismaClient();

const resolvers = {
  Query: {
    users: async () =&gt; {
      return await prisma.user.findMany();
    },

    user: async (_, { id }) =&gt; {
      return await prisma.user.findUnique({
        where: { id: parseInt(id) }
      });
    }
  },

  User: {
    posts: async (user) =&gt; {
      return await prisma.post.findMany({
        where: { authorId: user.id }
      });
    }
  },

  Mutation: {
    createUser: async (_, { input }) =&gt; {
      return await prisma.user.create({
        data: input
      });
    },

    createPost: async (_, { input }) =&gt; {
      return await prisma.post.create({
        data: input,
        include: { author: true }
      });
    }
  }
};</code></pre>
</div>
</div>
<hr>
<div class="paragraph">
<p><strong>Integración con MongoDB</strong></p>
</div>
<div class="paragraph">
<p><strong>Setup:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">npm install mongoose</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Modelos Mongoose:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const mongoose = require('mongoose');

const userSchema = new mongoose.Schema({
  name: String,
  email: String,
  createdAt: { type: Date, default: Date.now }
});

const postSchema = new mongoose.Schema({
  title: String,
  content: String,
  authorId: mongoose.Schema.Types.ObjectId,
  createdAt: { type: Date, default: Date.now }
});

const User = mongoose.model('User', userSchema);
const Post = mongoose.model('Post', postSchema);

module.exports = { User, Post };</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Resolvers con MongoDB:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const { User, Post } = require('./models');

const resolvers = {
  Query: {
    users: async () =&gt; {
      return await User.find();
    },

    user: async (_, { id }) =&gt; {
      return await User.findById(id);
    }
  },

  User: {
    posts: async (user) =&gt; {
      return await Post.find({ authorId: user._id });
    }
  },

  Mutation: {
    createUser: async (_, { input }) =&gt; {
      const user = new User(input);
      return await user.save();
    },

    updateUser: async (_, { id, input }) =&gt; {
      return await User.findByIdAndUpdate(id, input, { new: true });
    },

    deleteUser: async (_, { id }) =&gt; {
      await User.findByIdAndDelete(id);
      return true;
    }
  }
};</code></pre>
</div>
</div>
<hr>
<div class="paragraph">
<p><strong>Integración con PostgreSQL (Raw SQL)</strong></p>
</div>
<div class="paragraph">
<p><strong>Setup:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">npm install pg</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Connection Pool:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const { Pool } = require('pg');

const pool = new Pool({
  user: 'postgres',
  password: 'password',
  host: 'localhost',
  port: 5432,
  database: 'graphql_db'
});

module.exports = pool;</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Resolvers con PostgreSQL:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const pool = require('./db');

const resolvers = {
  Query: {
    users: async () =&gt; {
      const result = await pool.query('SELECT * FROM users');
      return result.rows;
    },

    user: async (_, { id }) =&gt; {
      const result = await pool.query(
        'SELECT * FROM users WHERE id = $1',
        [id]
      );
      return result.rows[0];
    }
  },

  User: {
    posts: async (user) =&gt; {
      const result = await pool.query(
        'SELECT * FROM posts WHERE author_id = $1',
        [user.id]
      );
      return result.rows;
    }
  },

  Mutation: {
    createUser: async (_, { input }) =&gt; {
      const result = await pool.query(
        'INSERT INTO users (name, email) VALUES ($1, $2) RETURNING *',
        [input.name, input.email]
      );
      return result.rows[0];
    }
  }
};</code></pre>
</div>
</div>
<hr>
<div class="paragraph">
<p><strong>DataLoader para Evitar N+1</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const DataLoader = require('dataloader');

// Crear loaders
const userLoader = new DataLoader(async (userIds) =&gt; {
  const result = await pool.query(
    'SELECT * FROM users WHERE id = ANY($1)',
    [userIds]
  );

  const usersMap = {};
  result.rows.forEach(user =&gt; {
    usersMap[user.id] = user;
  });

  return userIds.map(id =&gt; usersMap[id]);
});

const postLoader = new DataLoader(async (userIds) =&gt; {
  const result = await pool.query(
    'SELECT * FROM posts WHERE author_id = ANY($1)',
    [userIds]
  );

  const postsMap = {};
  result.rows.forEach(post =&gt; {
    if (!postsMap[post.author_id]) {
      postsMap[post.author_id] = [];
    }
    postsMap[post.author_id].push(post);
  });

  return userIds.map(id =&gt; postsMap[id] || []);
});

// Usar en resolvers
const resolvers = {
  Query: {
    users: async () =&gt; {
      const result = await pool.query('SELECT * FROM users');
      return result.rows;
    }
  },

  User: {
    posts: async (user) =&gt; {
      return postLoader.load(user.id);
    }
  }
};

// Crear nuevo contexto para cada request
const context = () =&gt; ({
  userLoader,
  postLoader
});</code></pre>
</div>
</div>
<hr>
<div class="paragraph">
<p><strong>Checklist de Integración con BD:</strong></p>
</div>
<div class="paragraph">
<p>✅ Conexión a BD establecida
✅ Modelos/esquemas definidos
✅ Resolvers implementados
✅ Manejo de errores
✅ Validación de datos
✅ DataLoader configurado
✅ Índices en BD
✅ Connection pooling
✅ Cleanup de conexiones
✅ Testing de resolvers</p>
</div>
<hr>
</div>
</div>
<div class="sect2">
<h3 id="_módulo_6_autenticación_y_seguridad_7_horas">MÓDULO 6: Autenticación y Seguridad (7 horas)</h3>
<div class="sect3">
<h4 id="_6_1_autenticación">6.1 Autenticación</h4>
<div class="paragraph">
<p><strong>Conceptos Fundamentales</strong></p>
</div>
<div class="paragraph">
<p><strong>Autenticación vs Autorización:</strong></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Autenticación</th>
<th class="tableblock halign-left valign-top">Autorización</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">¿Quién eres?</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">¿Qué puedes hacer?</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Verificar identidad</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Verificar permisos</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Usuario + Contraseña</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Roles, permisos</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Una sola vez al inicio</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">En cada operación</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ej: Login</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ej: Acceso a recurso</p></td>
</tr>
</tbody>
</table>
<hr>
<div class="paragraph">
<p><strong>JWT (JSON Web Tokens)</strong></p>
</div>
<div class="paragraph">
<p>JWT es el estándar más popular para autenticación en GraphQL.</p>
</div>
<div class="paragraph">
<p><strong>Estructura de JWT:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.
eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.
SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Partes:</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Header</strong> (Base64):</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "alg": "HS256",
  "typ": "JWT"
}</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Payload</strong> (Base64):</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "sub": "1234567890",
  "name": "John Doe",
  "email": "john@example.com",
  "role": "admin",
  "iat": 1516239022
}</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Signature</strong> (HMAC):</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>HMACSHA256(base64Header + "." + base64Payload, secret)</code></pre>
</div>
</div>
<hr>
<div class="paragraph">
<p><strong>Flujo de Autenticación con JWT:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>1. Cliente envía credenciales (email, contraseña)
                │
                ▼
2. Servidor valida credenciales
                │
                ▼
3. Servidor crea JWT
                │
                ▼
4. Servidor envía JWT al cliente
                │
                ▼
5. Cliente almacena JWT
                │
                ▼
6. Cliente envía JWT en headers (Authorization: Bearer &lt;token&gt;)
                │
                ▼
7. Servidor verifica JWT
                │
                ▼
8. Servidor procesa request autenticado</code></pre>
</div>
</div>
<hr>
<div class="paragraph">
<p><strong>Implementación de JWT en Apollo Server:</strong></p>
</div>
<div class="paragraph">
<p><strong>Schema:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-graphql" data-lang="graphql">type User {
  id: ID!
  name: String!
  email: String!
  role: UserRole!
}

type AuthPayload {
  token: String!
  user: User!
}

type Mutation {
  login(email: String!, password: String!): AuthPayload!
  logout: Boolean!
  refreshToken(token: String!): AuthPayload!
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Servidor (Apollo Server + Express):</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const jwt = require('jsonwebtoken');
const bcrypt = require('bcrypt');

const JWT_SECRET = process.env.JWT_SECRET || 'your-secret-key';
const JWT_EXPIRES_IN = '7d';

const resolvers = {
  Mutation: {
    login: async (_, { email, password }) =&gt; {
      // Buscar usuario
      const user = await db.users.findByEmail(email);

      if (!user) {
        throw new Error('Usuario no encontrado');
      }

      // Verificar contraseña
      const isPasswordValid = await bcrypt.compare(password, user.password);

      if (!isPasswordValid) {
        throw new Error('Contraseña incorrecta');
      }

      // Crear JWT
      const token = jwt.sign(
        {
          userId: user.id,
          email: user.email,
          role: user.role
        },
        JWT_SECRET,
        { expiresIn: JWT_EXPIRES_IN }
      );

      return {
        token,
        user
      };
    },

    logout: async (_, __, { user }) =&gt; {
      // En cliente: eliminar token del localStorage
      // En servidor: puede invalidar token en blacklist
      return true;
    },

    refreshToken: async (_, { token }) =&gt; {
      try {
        // Verificar token actual (aunque esté expirado)
        const decoded = jwt.verify(token, JWT_SECRET, { ignoreExpiration: true });

        // Obtener usuario
        const user = await db.users.findById(decoded.userId);

        if (!user) {
          throw new Error('Usuario no encontrado');
        }

        // Crear nuevo token
        const newToken = jwt.sign(
          {
            userId: user.id,
            email: user.email,
            role: user.role
          },
          JWT_SECRET,
          { expiresIn: JWT_EXPIRES_IN }
        );

        return {
          token: newToken,
          user
        };
      } catch (error) {
        throw new Error('Token inválido');
      }
    }
  }
};

// Middleware de autenticación
const getUser = (token) =&gt; {
  if (!token) return null;

  try {
    // Remover "Bearer " del inicio
    const cleanToken = token.replace('Bearer ', '');
    return jwt.verify(cleanToken, JWT_SECRET);
  } catch (error) {
    return null;
  }
};

// Crear servidor
const server = new ApolloServer({
  typeDefs,
  resolvers,
  context: ({ req }) =&gt; {
    const token = req.headers.authorization;
    const user = getUser(token);
    return { user, db };
  }
});</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Cliente (JavaScript):</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">// 1. Login
const loginResponse = await fetch('http://localhost:4000/graphql', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    query: `
      mutation {
        login(email: "user@example.com", password: "password123") {
          token
          user { id name email }
        }
      }
    `
  })
});

const { data } = await loginResponse.json();
const token = data.login.token;

// 2. Guardar token
localStorage.setItem('auth_token', token);

// 3. Usar token en próximas requests
const response = await fetch('http://localhost:4000/graphql', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
    'Authorization': `Bearer ${token}`
  },
  body: JSON.stringify({
    query: `
      query {
        me {
          id
          name
          email
        }
      }
    `
  })
});

// 4. Renovar token
const refreshResponse = await fetch('http://localhost:4000/graphql', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    query: `
      mutation {
        refreshToken(token: "${token}") {
          token
          user { id }
        }
      }
    `
  })
});</code></pre>
</div>
</div>
<hr>
<div class="paragraph">
<p><strong>Sessions</strong></p>
</div>
<div class="paragraph">
<p>Las sessions almacenan datos del usuario en el servidor.</p>
</div>
<div class="paragraph">
<p><strong>Flujo de Sessions:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>1. Cliente login → Servidor crea session
                → Servidor genera sessionId
                → Servidor envía sessionId en cookie

2. Cliente envía request → Cookie con sessionId
                          → Servidor busca session
                          → Servidor recupera datos</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Implementación con Express + Sessions:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const session = require('express-session');
const RedisStore = require('connect-redis').default;
const { createClient } = require('redis');

// Cliente de Redis
const redisClient = createClient();
redisClient.connect();

const app = express();

// Configurar sessions
app.use(session({
  store: new RedisStore({ client: redisClient }),
  secret: 'your-secret-key',
  resave: false,
  saveUninitialized: false,
  cookie: {
    secure: true,
    httpOnly: true,
    maxAge: 1000 * 60 * 60 * 24 * 7 // 7 días
  }
}));

// Resolver de login con session
const resolvers = {
  Mutation: {
    login: async (_, { email, password }, { req }) =&gt; {
      const user = await db.users.findByEmail(email);

      if (!user || !await bcrypt.compare(password, user.password)) {
        throw new Error('Credenciales inválidas');
      }

      // Guardar en session
      req.session.userId = user.id;
      req.session.userRole = user.role;

      return {
        user,
        success: true
      };
    },

    logout: async (_, __, { req }) =&gt; {
      req.session.destroy((err) =&gt; {
        if (err) throw err;
      });
      return true;
    }
  }
};</code></pre>
</div>
</div>
<hr>
<div class="paragraph">
<p><strong>OAuth 2.0 con GraphQL</strong></p>
</div>
<div class="paragraph">
<p>OAuth permite autenticación con terceros (Google, GitHub, etc.).</p>
</div>
<div class="paragraph">
<p><strong>Flujo OAuth:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>1. Cliente click "Login con Google"
                │
                ▼
2. Redirige a Google (Google pide permisos)
                │
                ▼
3. Usuario autoriza
                │
                ▼
4. Google redirige a app con código
                │
                ▼
5. App envía código a servidor
                │
                ▼
6. Servidor intercambia código por token
                │
                ▼
7. Servidor obtiene perfil de Google
                │
                ▼
8. Servidor crea/obtiene usuario local
                │
                ▼
9. Servidor envía JWT al cliente</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Implementación:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const { google } = require('googleapis');

const oauth2Client = new google.auth.OAuth2(
  process.env.GOOGLE_CLIENT_ID,
  process.env.GOOGLE_CLIENT_SECRET,
  process.env.GOOGLE_CALLBACK_URL
);

const resolvers = {
  Mutation: {
    googleLogin: async (_, { code }) =&gt; {
      try {
        // Intercambiar código por tokens
        const { tokens } = await oauth2Client.getToken(code);
        oauth2Client.setCredentials(tokens);

        // Obtener perfil del usuario
        const oauth2 = google.oauth2({
          auth: oauth2Client,
          version: 'v2'
        });

        const { data } = await oauth2.userinfo.get();

        // Buscar o crear usuario
        let user = await db.users.findByEmail(data.email);

        if (!user) {
          user = await db.users.create({
            email: data.email,
            name: data.name,
            googleId: data.id,
            picture: data.picture
          });
        }

        // Crear JWT
        const token = jwt.sign(
          { userId: user.id, email: user.email },
          JWT_SECRET,
          { expiresIn: '7d' }
        );

        return { token, user };
      } catch (error) {
        throw new Error('OAuth error');
      }
    }
  }
};</code></pre>
</div>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="_6_2_autorización">6.2 Autorización</h4>
<div class="paragraph">
<p><strong>RBAC (Role-Based Access Control)</strong></p>
</div>
<div class="paragraph">
<p>RBAC controla qué puede hacer cada rol.</p>
</div>
<div class="paragraph">
<p><strong>Roles Comunes:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-graphql" data-lang="graphql">enum UserRole {
  ADMIN      # Acceso total
  MODERATOR  # Gestión de contenido
  AUTHOR     # Crear contenido
  USER       # Usar la app
  GUEST      # Vista limitada
}

type User {
  id: ID!
  name: String!
  role: UserRole!
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Control por Rol:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-graphql" data-lang="graphql">type Query {
  # Solo admin
  allUsers: [User!]! @requiresRole(role: ADMIN)

  # Admin y moderador
  reportedContent: [Content!]! @requiresRole(role: [ADMIN, MODERATOR])

  # Cualquiera autenticado
  myPosts: [Post!]! @requiresAuth

  # Público
  publicPosts: [Post!]!
}

type Mutation {
  deleteUser(id: ID!): Boolean! @requiresRole(role: ADMIN)
  publishPost(id: ID!): Post! @requiresRole(role: [AUTHOR, ADMIN])
  createComment(id: ID!): Comment! @requiresAuth
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Implementación de Directiva:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const { SchemaDirectiveVisitor } = require('apollo-server');

class AuthDirective extends SchemaDirectiveVisitor {
  visitFieldDefinition(field) {
    const originalResolve = field.resolve;

    field.resolve = async (obj, args, context, info) =&gt; {
      const user = context.user;

      // Verificar que el usuario esté autenticado
      if (!user) {
        throw new Error('Debe estar autenticado');
      }

      return originalResolve(obj, args, context, info);
    };
  }
}

class RoleDirective extends SchemaDirectiveVisitor {
  visitFieldDefinition(field) {
    const originalResolve = field.resolve;
    const requiredRole = this.args.role;

    field.resolve = async (obj, args, context, info) =&gt; {
      const user = context.user;

      if (!user) {
        throw new Error('Debe estar autenticado');
      }

      // Si requiredRole es array, verificar si el usuario tiene cualquiera
      const allowedRoles = Array.isArray(requiredRole) ? requiredRole : [requiredRole];

      if (!allowedRoles.includes(user.role)) {
        throw new Error(`Requiere uno de estos roles: ${allowedRoles.join(', ')}`);
      }

      return originalResolve(obj, args, context, info);
    };
  }
}

const typeDefs = gql`
  directive @requiresAuth on FIELD_DEFINITION
  directive @requiresRole(role: [String!]!) on FIELD_DEFINITION

  type Query {
    publicData: String
    privateData: String @requiresAuth
    adminData: String @requiresRole(role: "ADMIN")
  }
`;

const server = new ApolloServer({
  typeDefs,
  resolvers,
  schemaDirectives: {
    requiresAuth: AuthDirective,
    requiresRole: RoleDirective
  }
});</code></pre>
</div>
</div>
<hr>
<div class="paragraph">
<p><strong>Field-Level Authorization</strong></p>
</div>
<div class="paragraph">
<p>Proteger campos específicos basado en permisos.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">// Schema
const typeDefs = gql`
  type User {
    id: ID!
    name: String!
    email: String! @requiresOwnerOrAdmin
    role: UserRole! @requiresAdmin
    password: String! @requiresOwner
  }
`;

// Directiva @requiresOwnerOrAdmin
class OwnerOrAdminDirective extends SchemaDirectiveVisitor {
  visitFieldDefinition(field) {
    const originalResolve = field.resolve;

    field.resolve = async (obj, args, context, info) =&gt; {
      const user = context.user;

      if (!user) {
        throw new Error('No autenticado');
      }

      // El usuario es admin o es el propietario del recurso
      const isAdmin = user.role === 'ADMIN';
      const isOwner = obj.id === user.userId;

      if (!isAdmin &amp;&amp; !isOwner) {
        throw new Error('No tienes permiso para ver este campo');
      }

      return originalResolve(obj, args, context, info);
    };
  }
}

// Usar
const resolvers = {
  Query: {
    user: async (_, { id }, { user }) =&gt; {
      const targetUser = await db.users.findById(id);
      return targetUser; // La directiva protege fields sensibles
    }
  }
};</code></pre>
</div>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="_6_3_seguridad_en_graphql">6.3 Seguridad en GraphQL</h4>
<div class="paragraph">
<p><strong>Protección contra Ataques Comunes</strong></p>
</div>
<div class="paragraph">
<p><strong>1. Injection Attacks</strong></p>
</div>
<div class="paragraph">
<p><strong>Problema:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-graphql" data-lang="graphql"># Entrada maliciosa
query {
  user(email: "admin' OR '1'='1") {
    name
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Solución:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">// Usar variables (previene inyección)
const query = `
  query GetUser($email: String!) {
    user(email: $email) {
      name
    }
  }
`;

// Pasar datos separados
const variables = {
  email: "admin' OR '1'='1"  // Tratado como string literal
};</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>2. Denial of Service (DoS)</strong></p>
</div>
<div class="paragraph">
<p><strong>Problema: Query Maliciosa Compleja</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-graphql" data-lang="graphql">query {
  user {
    posts {
      comments {
        replies {
          author {
            posts { ... 100 niveles ... }
          }
        }
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Solución: Depth Limiting</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const { depthLimit } = require('graphql-depth-limit');

const server = new ApolloServer({
  typeDefs,
  resolvers,
  validationRules: [depthLimit(10)] // Máximo 10 niveles
});</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>3. Query Complexity Attacks</strong></p>
</div>
<div class="paragraph">
<p><strong>Problema:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-graphql" data-lang="graphql">query {
  posts(first: 1000000) {
    comments(first: 1000000) {
      replies(first: 1000000) {
        text
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Solución:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const { costAnalysis } = require('graphql-cost-analysis');

const server = new ApolloServer({
  typeDefs: addCostAnalysisDirective(typeDefs),
  resolvers,
  validationRules: [
    costAnalysis({
      maximumCost: 5000
    })
  ]
});

// Schema con costos
const typeDefs = gql`
  type Query {
    posts(first: Int): [Post!]! @cost(complexity: 1, multipliers: ["first"])
  }

  type Post {
    comments(first: Int): [Comment!]! @cost(complexity: 2, multipliers: ["first"])
  }
`;</code></pre>
</div>
</div>
<hr>
<div class="paragraph">
<p><strong>Rate Limiting</strong></p>
</div>
<div class="paragraph">
<p>Limitar número de requests por usuario/IP.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const rateLimit = require('express-rate-limit');
const RedisStore = require('rate-limit-redis');
const redis = require('redis');

const redisClient = redis.createClient();

// Rate limiter por IP
const limiter = rateLimit({
  store: new RedisStore({
    client: redisClient,
    prefix: 'rl:' // rate limit prefix
  }),
  windowMs: 15 * 60 * 1000, // 15 minutos
  max: 100 // máximo 100 requests
});

// Rate limiter por usuario (en GraphQL)
const graphqlLimiter = rateLimit({
  store: new RedisStore({
    client: redisClient,
    prefix: 'gql:'
  }),
  keyGenerator: (req) =&gt; {
    // Usar usuario autenticado si existe
    return req.user?.id || req.ip;
  },
  windowMs: 60 * 1000, // 1 minuto
  max: 30 // máximo 30 queries por minuto
});

app.use('/graphql', limiter);
app.use('/graphql', graphqlLimiter);</code></pre>
</div>
</div>
<hr>
<div class="paragraph">
<p><strong>CSRF Protection</strong></p>
</div>
<div class="paragraph">
<p>Protección contra Cross-Site Request Forgery.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const csrf = require('csurf');
const cookieParser = require('cookie-parser');

app.use(cookieParser());
app.use(csrf({ cookie: false }));

// Middleware para obtener token CSRF
app.get('/csrf-token', (req, res) =&gt; {
  res.json({ token: req.csrfToken() });
});

// GraphQL endpoint protegido
app.post('/graphql', (req, res, next) =&gt; {
  // Validar token CSRF
  const token = req.body.csrfToken || req.headers['x-csrf-token'];

  if (!token || token !== req.csrfToken()) {
    return res.status(403).json({ error: 'CSRF token inválido' });
  }

  next();
});</code></pre>
</div>
</div>
<hr>
<div class="paragraph">
<p><strong>Validación de Entrada</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">// Validadores de seguridad
const sanitizers = {
  string: (value, maxLength = 1000) =&gt; {
    if (typeof value !== 'string') throw new Error('Debe ser string');
    if (value.length &gt; maxLength) throw new Error('Muy largo');
    // Remover caracteres peligrosos
    return value.trim().replace(/&lt;[^&gt;]*&gt;/g, '');
  },

  email: (value) =&gt; {
    const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    if (!re.test(value)) throw new Error('Email inválido');
    return value.toLowerCase();
  },

  url: (value) =&gt; {
    try {
      new URL(value);
      return value;
    } catch {
      throw new Error('URL inválida');
    }
  }
};

// Usar en resolver
const resolvers = {
  Mutation: {
    createPost: async (_, { input }) =&gt; {
      const sanitized = {
        title: sanitizers.string(input.title, 200),
        content: sanitizers.string(input.content, 5000),
        url: input.url ? sanitizers.url(input.url) : null
      };

      return await db.posts.create(sanitized);
    }
  }
};</code></pre>
</div>
</div>
<hr>
<div class="paragraph">
<p><strong>HTTPS y Headers de Seguridad</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const helmet = require('helmet');

// Agregar headers de seguridad
app.use(helmet());

// Configuración específica
app.use(helmet.contentSecurityPolicy({
  directives: {
    defaultSrc: ["'self'"],
    scriptSrc: ["'self'", "'unsafe-inline'"],
    styleSrc: ["'self'", "'unsafe-inline'"]
  }
}));

// HTTPS obligatorio
if (process.env.NODE_ENV === 'production') {
  app.use((req, res, next) =&gt; {
    if (req.header('x-forwarded-proto') !== 'https') {
      res.redirect(`https://${req.header('host')}${req.url}`);
    } else {
      next();
    }
  });
}</code></pre>
</div>
</div>
<hr>
<div class="paragraph">
<p><strong>Checklist de Seguridad GraphQL:</strong></p>
</div>
<div class="paragraph">
<p>✅ Usar variables en queries (prevenir inyección)
✅ Autenticar y autorizar todas las operaciones
✅ Limitar profundidad de queries (depth limiting)
✅ Implementar query complexity analysis
✅ Rate limiting por usuario/IP
✅ CSRF protection
✅ Validar y sanitizar entrada
✅ HTTPS en producción
✅ Headers de seguridad (Helmet)
✅ Loguear intentos de acceso no autorizado
✅ Usar JWT con expiración
✅ Almacenar contraseñas hasheadas (bcrypt)
✅ Environment variables para secrets
✅ Monitoreo de seguridad
✅ Auditoría de accesos</p>
</div>
<hr>
</div>
</div>
<div class="sect2">
<h3 id="_módulo_7_clientes_graphql_8_horas">MÓDULO 7: Clientes GraphQL (8 horas)</h3>
<div class="sect3">
<h4 id="_7_1_apollo_client">7.1 Apollo Client</h4>
<div class="paragraph">
<p><strong>Introducción a Apollo Client</strong></p>
</div>
<div class="paragraph">
<p>Apollo Client es la <strong>librería más popular</strong> para consumir APIs GraphQL desde el cliente. Proporciona:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>✅ Ejecución de queries y mutations</p>
</li>
<li>
<p>✅ Caché automático</p>
</li>
<li>
<p>✅ Manejo de estado</p>
</li>
<li>
<p>✅ Subscriptions con WebSockets</p>
</li>
<li>
<p>✅ DevTools para debugging</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Instalación:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">npm install @apollo/client graphql</code></pre>
</div>
</div>
<hr>
<div class="paragraph">
<p><strong>Setup Inicial</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">import { ApolloClient, InMemoryCache, HttpLink } from '@apollo/client';

const client = new ApolloClient({
  // Link HTTP para conectar con el servidor
  link: new HttpLink({
    uri: 'http://localhost:4000/graphql',
    credentials: 'include' // Enviar cookies
  }),

  // Cache en memoria
  cache: new InMemoryCache()
});</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Con React Provider:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">import { ApolloProvider } from '@apollo/client';

function App() {
  return (
    &lt;ApolloProvider client={client}&gt;
      &lt;MainApp /&gt;
    &lt;/ApolloProvider&gt;
  );
}

export default App;</code></pre>
</div>
</div>
<hr>
<div class="paragraph">
<p><strong>Queries con Apollo Client</strong></p>
</div>
<div class="paragraph">
<p><strong>Hook useQuery:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">import { useQuery, gql } from '@apollo/client';

const GET_USERS = gql`
  query GetUsers {
    users {
      id
      name
      email
    }
  }
`;

function UsersList() {
  const { loading, error, data } = useQuery(GET_USERS);

  if (loading) return &lt;p&gt;Cargando...&lt;/p&gt;;
  if (error) return &lt;p&gt;Error: {error.message}&lt;/p&gt;;

  return (
    &lt;ul&gt;
      {data.users.map(user =&gt; (
        &lt;li key={user.id}&gt;{user.name}&lt;/li&gt;
      ))}
    &lt;/ul&gt;
  );
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Queries con Variables:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const GET_USER = gql`
  query GetUser($id: ID!) {
    user(id: $id) {
      id
      name
      email
      posts {
        id
        title
      }
    }
  }
`;

function UserDetail({ userId }) {
  const { loading, data } = useQuery(GET_USER, {
    variables: { id: userId }
  });

  if (loading) return &lt;p&gt;Cargando usuario...&lt;/p&gt;;

  const user = data?.user;
  return (
    &lt;div&gt;
      &lt;h1&gt;{user.name}&lt;/h1&gt;
      &lt;p&gt;{user.email}&lt;/p&gt;
      &lt;h2&gt;Posts:&lt;/h2&gt;
      &lt;ul&gt;
        {user.posts.map(post =&gt; (
          &lt;li key={post.id}&gt;{post.title}&lt;/li&gt;
        ))}
      &lt;/ul&gt;
    &lt;/div&gt;
  );
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Opciones del Hook useQuery:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const { data, loading, error } = useQuery(GET_USERS, {
  // Estrategia de cache
  fetchPolicy: 'cache-first',  // cache-first | network-only | no-cache

  // Polling
  pollInterval: 5000,           // Refetch cada 5 segundos

  // Skip query condicionalmente
  skip: !isLoggedIn,

  // Callback cuando completa
  onCompleted: (data) =&gt; {
    console.log('Query completada:', data);
  },

  // Callback en error
  onError: (error) =&gt; {
    console.error('Error en query:', error);
  },

  // Variables
  variables: { limit: 10, offset: 0 },

  // Context
  context: {
    headers: {
      authorization: `Bearer ${token}`
    }
  }
});</code></pre>
</div>
</div>
<hr>
<div class="paragraph">
<p><strong>Mutations con Apollo Client</strong></p>
</div>
<div class="paragraph">
<p><strong>Hook useMutation:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">import { useMutation, gql } from '@apollo/client';

const CREATE_USER = gql`
  mutation CreateUser($input: CreateUserInput!) {
    createUser(input: $input) {
      id
      name
      email
    }
  }
`;

function CreateUserForm() {
  const [createUser, { loading, error }] = useMutation(CREATE_USER);

  const handleSubmit = async (e) =&gt; {
    e.preventDefault();

    try {
      const { data } = await createUser({
        variables: {
          input: {
            name: 'Juan',
            email: 'juan@example.com',
            password: 'secure123'
          }
        }
      });

      console.log('Usuario creado:', data.createUser);
    } catch (err) {
      console.error('Error:', err);
    }
  };

  return (
    &lt;form onSubmit={handleSubmit}&gt;
      &lt;button type="submit" disabled={loading}&gt;
        {loading ? 'Creando...' : 'Crear usuario'}
      &lt;/button&gt;
      {error &amp;&amp; &lt;p&gt;{error.message}&lt;/p&gt;}
    &lt;/form&gt;
  );
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Actualizar Cache Después de Mutation:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const UPDATE_USER = gql`
  mutation UpdateUser($id: ID!, $input: UpdateUserInput!) {
    updateUser(id: $id, input: $input) {
      id
      name
      email
    }
  }
`;

function UpdateUserForm({ userId }) {
  const [updateUser] = useMutation(UPDATE_USER, {
    // Actualizar cache después de mutation
    update: (cache, { data: { updateUser } }) =&gt; {
      cache.modify({
        fields: {
          user: (existingUser) =&gt; {
            if (existingUser.id === userId) {
              return updateUser;
            }
            return existingUser;
          }
        }
      });
    },

    // O refetch queries
    refetchQueries: [{ query: GET_USER, variables: { id: userId } }]
  });

  const handleUpdate = async (formData) =&gt; {
    await updateUser({
      variables: {
        id: userId,
        input: formData
      }
    });
  };

  return (
    // Formulario aquí
  );
}</code></pre>
</div>
</div>
<hr>
<div class="paragraph">
<p><strong>Subscriptions con Apollo Client</strong></p>
</div>
<div class="paragraph">
<p><strong>Setup con WebSocket Link:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">import { ApolloClient, InMemoryCache, split } from '@apollo/client';
import { HttpLink } from '@apollo/client/link/http';
import { GraphQLWsLink } from '@apollo/client/link/subscriptions';
import { getMainDefinition } from '@apollo/client/utilities';
import { createClient } from 'graphql-ws';

const httpLink = new HttpLink({
  uri: 'http://localhost:4000/graphql'
});

const wsLink = new GraphQLWsLink(
  createClient({
    url: 'ws://localhost:4000/graphql'
  })
);

const splitLink = split(
  ({ query }) =&gt; {
    const definition = getMainDefinition(query);
    return (
      definition.kind === 'OperationDefinition' &amp;&amp;
      definition.operation === 'subscription'
    );
  },
  wsLink,
  httpLink
);

const client = new ApolloClient({
  link: splitLink,
  cache: new InMemoryCache()
});</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Hook useSubscription:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">import { useSubscription, gql } from '@apollo/client';

const ON_USER_CREATED = gql`
  subscription OnUserCreated {
    userCreated {
      id
      name
      email
      createdAt
    }
  }
`;

function UserNotifications() {
  const { loading, error, data } = useSubscription(ON_USER_CREATED);

  if (loading) return &lt;p&gt;Esperando notificaciones...&lt;/p&gt;;
  if (error) return &lt;p&gt;Error: {error.message}&lt;/p&gt;;

  return (
    &lt;div&gt;
      {data?.userCreated &amp;&amp; (
        &lt;p&gt;Nuevo usuario: {data.userCreated.name}&lt;/p&gt;
      )}
    &lt;/div&gt;
  );
}</code></pre>
</div>
</div>
<hr>
<div class="paragraph">
<p><strong>Caché en Apollo Client</strong></p>
</div>
<div class="paragraph">
<p><strong>InMemoryCache:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const cache = new InMemoryCache({
  typePolicies: {
    Query: {
      fields: {
        users: {
          merge(existing = [], incoming) {
            return incoming;
          }
        }
      }
    },
    User: {
      keyFields: ['id']  // Identificar Users por ID
    }
  }
});</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Lectura y Escritura Manuales:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">// Leer del cache
const user = client.cache.readQuery({
  query: GET_USER,
  variables: { id: '1' }
});

// Escribir en cache
client.cache.writeQuery({
  query: GET_USER,
  variables: { id: '1' },
  data: {
    user: {
      id: '1',
      name: 'Juan Actualizado',
      email: 'juan@example.com',
      __typename: 'User'
    }
  }
});</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Estrategias de Caché:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-graphql" data-lang="graphql">// En hook useQuery
const { data } = useQuery(GET_USERS, {
  // 1. cache-first: Usa cache si existe, si no fetch
  fetchPolicy: 'cache-first',

  // 2. cache-and-network: Retorna cache pero también fetch
  fetchPolicy: 'cache-and-network',

  // 3. network-only: Siempre fetch del servidor
  fetchPolicy: 'network-only',

  // 4. no-cache: No guarda en cache
  fetchPolicy: 'no-cache',

  // 5. cache-only: Solo cache, falla si no existe
  fetchPolicy: 'cache-only'
});</code></pre>
</div>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="_7_2_clientes_graphql_alternativos">7.2 Clientes GraphQL Alternativos</h4>
<div class="paragraph">
<p><strong>urql</strong></p>
</div>
<div class="paragraph">
<p>Librería ligera y flexible.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">npm install urql graphql</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Uso básico:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">import { createClient } from 'urql';

const client = createClient({
  url: 'http://localhost:4000/graphql'
});

// Con React
import { useQuery } from 'urql';

function App() {
  const [result] = useQuery({
    query: `
      query {
        users {
          id
          name
        }
      }
    `
  });

  if (result.fetching) return &lt;p&gt;Cargando...&lt;/p&gt;;
  if (result.error) return &lt;p&gt;Error&lt;/p&gt;;

  return (
    &lt;ul&gt;
      {result.data.users.map(user =&gt; (
        &lt;li key={user.id}&gt;{user.name}&lt;/li&gt;
      ))}
    &lt;/ul&gt;
  );
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Ventajas de urql:</strong>
- Más ligero que Apollo
- Menos configuración
- Excelente para casos simples</p>
</div>
<hr>
<div class="paragraph">
<p><strong>Relay</strong></p>
</div>
<div class="paragraph">
<p>Framework completo de Facebook para GraphQL.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">npm install react-relay relay-runtime</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Características:</strong>
- Colocation de datos y componentes
- Generación automática de tipos
- Compilación de queries
- Conexiones y paginación nativas</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">import { graphql, useFragment } from 'react-relay';

const UserFragment = graphql`
  fragment UserComponent_user on User {
    id
    name
    email
  }
`;

function UserComponent(props) {
  const user = useFragment(UserFragment, props.user);
  return &lt;div&gt;{user.name}&lt;/div&gt;;
}</code></pre>
</div>
</div>
<hr>
<div class="paragraph">
<p><strong>GraphQL Request</strong></p>
</div>
<div class="paragraph">
<p>Cliente minimalista para casos simples.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">npm install graphql-request graphql</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">import { GraphQLClient, gql } from 'graphql-request';

const client = new GraphQLClient('http://localhost:4000/graphql', {
  headers: {
    authorization: `Bearer ${token}`
  }
});

const GET_USERS = gql`
  query {
    users {
      id
      name
    }
  }
`;

// Usar
const data = await client.request(GET_USERS);</code></pre>
</div>
</div>
<hr>
<div class="paragraph">
<p><strong>Comparación de Clientes:</strong></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Aspecto</th>
<th class="tableblock halign-left valign-top">Apollo</th>
<th class="tableblock halign-left valign-top">urql</th>
<th class="tableblock halign-left valign-top">Relay</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tamaño</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Grande</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Pequeño</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mediano</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Curva Aprendizaje</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Media</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Baja</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Alta</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Caché</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Automático</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Automático</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Manual</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Documentación</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Excelente</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Buena</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Buena</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DevTools</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sí</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tipado</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bueno</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bueno</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Excelente</p></td>
</tr>
</tbody>
</table>
<hr>
</div>
<div class="sect3">
<h4 id="_7_3_integraciones_con_frameworks">7.3 Integraciones con Frameworks</h4>
<div class="paragraph">
<p><strong>Apollo Client + React</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">import { useQuery, useMutation, gql } from '@apollo/client';

// Query
const POSTS = gql`
  query GetPosts($limit: Int) {
    posts(limit: $limit) {
      id
      title
      author { name }
    }
  }
`;

function PostsList() {
  const { data, loading } = useQuery(POSTS, {
    variables: { limit: 10 }
  });

  return (
    &lt;div&gt;
      {data?.posts.map(post =&gt; (
        &lt;PostItem key={post.id} post={post} /&gt;
      ))}
    &lt;/div&gt;
  );
}

// Mutation
const CREATE_POST = gql`
  mutation CreatePost($input: CreatePostInput!) {
    createPost(input: $input) {
      id
      title
    }
  }
`;

function CreatePostForm() {
  const [createPost, { loading }] = useMutation(CREATE_POST);

  const handleSubmit = (e) =&gt; {
    e.preventDefault();
    createPost({
      variables: {
        input: {
          title: 'Mi primer post',
          content: 'Contenido...'
        }
      }
    });
  };

  return (
    &lt;form onSubmit={handleSubmit}&gt;
      &lt;button disabled={loading}&gt;
        {loading ? 'Publicando...' : 'Publicar'}
      &lt;/button&gt;
    &lt;/form&gt;
  );
}</code></pre>
</div>
</div>
<hr>
<div class="paragraph">
<p><strong>Apollo Client + Vue</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">npm install @vue/apollo-composable</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">import { useQuery, useMutation } from '@vue/apollo-composable';
import { gql } from '@apollo/client';

const USERS = gql`
  query {
    users {
      id
      name
    }
  }
`;

export default {
  setup() {
    const { result, loading } = useQuery(USERS);

    return {
      users: () =&gt; result.value?.users || [],
      loading
    };
  }
};</code></pre>
</div>
</div>
<div class="paragraph">
<p>Template:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-vue" data-lang="vue">&lt;template&gt;
  &lt;div v-if="loading"&gt;Cargando...&lt;/div&gt;
  &lt;ul v-else&gt;
    &lt;li v-for="user in users" :key="user.id"&gt;
      {{ user.name }}
    &lt;/li&gt;
  &lt;/ul&gt;
&lt;/template&gt;</code></pre>
</div>
</div>
<hr>
<div class="paragraph">
<p><strong>Apollo Client + Angular</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">npm install apollo-angular @apollo/client graphql</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-typescript" data-lang="typescript">import { Apollo, gql } from 'apollo-angular';
import { Component } from '@angular/core';

const USERS = gql`
  query {
    users {
      id
      name
    }
  }
`;

@Component({
  selector: 'app-users',
  template: `
    &lt;div&gt;
      &lt;div *ngIf="loading"&gt;Cargando...&lt;/div&gt;
      &lt;ul *ngIf="!loading"&gt;
        &lt;li *ngFor="let user of users"&gt;{{ user.name }}&lt;/li&gt;
      &lt;/ul&gt;
    &lt;/div&gt;
  `
})
export class UsersComponent {
  users: any[] = [];
  loading = true;

  constructor(private apollo: Apollo) {
    this.apollo.watchQuery({
      query: USERS
    }).valueChanges.subscribe(result =&gt; {
      this.users = result.data?.users;
      this.loading = result.loading;
    });
  }
}</code></pre>
</div>
</div>
<hr>
<div class="paragraph">
<p><strong>State Management con Apollo</strong></p>
</div>
<div class="paragraph">
<p><strong>Reactive Variables:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">import { makeVar } from '@apollo/client';

// Variable reactiva
const isLoggedInVar = makeVar(false);
const userVar = makeVar(null);

// Usar en query
const GET_STATE = gql`
  query GetState {
    isLoggedIn @client
    currentUser @client {
      id
      name
    }
  }
`;

// Actualizar
function logout() {
  isLoggedInVar(false);
  userVar(null);
}

function login(user) {
  isLoggedInVar(true);
  userVar(user);
}</code></pre>
</div>
</div>
<hr>
<div class="paragraph">
<p><strong>Custom Hooks Reutilizables:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">// useUser.js
import { useQuery, gql } from '@apollo/client';

const GET_USER = gql`
  query GetUser($id: ID!) {
    user(id: $id) {
      id
      name
      email
      role
    }
  }
`;

export function useUser(userId) {
  const { data, loading, error } = useQuery(GET_USER, {
    variables: { id: userId }
  });

  return {
    user: data?.user,
    loading,
    error,
    isAdmin: data?.user?.role === 'ADMIN'
  };
}

// Usar en componente
function AdminPanel() {
  const { user, isAdmin, loading } = useUser(currentUserId);

  if (!isAdmin) return &lt;p&gt;No autorizado&lt;/p&gt;;

  return &lt;div&gt;Panel de Admin&lt;/div&gt;;
}</code></pre>
</div>
</div>
<hr>
<div class="paragraph">
<p><strong>Hook useDebounce para Búsqueda:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">import { useState, useEffect } from 'react';
import { useQuery, gql } from '@apollo/client';

const SEARCH_USERS = gql`
  query SearchUsers($query: String!) {
    searchUsers(query: $query) {
      id
      name
      email
    }
  }
`;

function useUserSearch(searchTerm, delay = 500) {
  const [debouncedTerm, setDebouncedTerm] = useState(searchTerm);

  useEffect(() =&gt; {
    const timer = setTimeout(() =&gt; {
      setDebouncedTerm(searchTerm);
    }, delay);

    return () =&gt; clearTimeout(timer);
  }, [searchTerm, delay]);

  const { data, loading } = useQuery(SEARCH_USERS, {
    variables: { query: debouncedTerm },
    skip: !debouncedTerm
  });

  return {
    results: data?.searchUsers || [],
    loading
  };
}

// Usar
function UserSearch() {
  const [term, setTerm] = useState('');
  const { results, loading } = useUserSearch(term);

  return (
    &lt;div&gt;
      &lt;input
        value={term}
        onChange={(e) =&gt; setTerm(e.target.value)}
        placeholder="Buscar usuarios..."
      /&gt;
      {loading &amp;&amp; &lt;p&gt;Buscando...&lt;/p&gt;}
      &lt;ul&gt;
        {results.map(user =&gt; (
          &lt;li key={user.id}&gt;{user.name}&lt;/li&gt;
        ))}
      &lt;/ul&gt;
    &lt;/div&gt;
  );
}</code></pre>
</div>
</div>
<hr>
<div class="paragraph">
<p><strong>Manejo de Errores Personalizado:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">import { useQuery, gql } from '@apollo/client';

const GET_DATA = gql`
  query {
    data {
      id
      value
    }
  }
`;

function DataDisplay() {
  const { data, loading, error, refetch } = useQuery(GET_DATA);

  if (loading) return &lt;p&gt;Cargando...&lt;/p&gt;;

  if (error) {
    return (
      &lt;div className="error"&gt;
        &lt;p&gt;Error: {error.message}&lt;/p&gt;
        &lt;button onClick={() =&gt; refetch()}&gt;
          Reintentar
        &lt;/button&gt;
      &lt;/div&gt;
    );
  }

  return &lt;div&gt;{data.data.value}&lt;/div&gt;;
}</code></pre>
</div>
</div>
<hr>
<div class="paragraph">
<p><strong>Checklist de Buenas Prácticas para Clientes:</strong></p>
</div>
<div class="paragraph">
<p>✅ Usar Apollo Client para aplicaciones grandes
✅ Usar urql para casos simples
✅ Implementar caché apropiadamente
✅ Usar variables en queries
✅ Crear custom hooks reutilizables
✅ Manejar loading y error states
✅ Validar datos antes de usar
✅ Usar fragments para reutilizar
✅ Implementar debounce en búsquedas
✅ DevTools para debugging
---</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_módulo_8_testing_7_horas">MÓDULO 8: Testing (7 horas)</h3>
<div class="sect3">
<h4 id="_8_1_testing_de_servidores_graphql">8.1 Testing de Servidores GraphQL</h4>
<div class="paragraph">
<p><strong>Importancia del Testing en GraphQL</strong></p>
</div>
<div class="paragraph">
<p>El testing en GraphQL es crítico porque:
- Validar la lógica de resolvers
- Asegurar que el schema es correcto
- Prevenir regresiones
- Documentar el comportamiento esperado
- Facilitar refactorización segura</p>
</div>
<hr>
<div class="paragraph">
<p><strong>Unit Tests para Resolvers</strong></p>
</div>
<div class="paragraph">
<p><strong>Setup de Testing:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">// jest.config.js
module.exports = {
  testEnvironment: 'node',
  collectCoverage: true,
  coveragePathIgnorePatterns: ['/node_modules/'],
  testMatch: ['**/__tests__/**/*.test.js']
};</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Test Básico de Resolver:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">// __tests__/resolvers.test.js
import { resolvers } from '../resolvers';

describe('Query Resolvers', () =&gt; {
  let db;

  beforeEach(() =&gt; {
    // Mock de base de datos
    db = {
      users: {
        findById: jest.fn(),
        findAll: jest.fn()
      }
    };
  });

  test('obtener usuario por ID', async () =&gt; {
    const mockUser = {
      id: '1',
      name: 'Juan',
      email: 'juan@example.com'
    };

    db.users.findById.mockResolvedValue(mockUser);

    const result = await resolvers.Query.user(
      null,
      { id: '1' },
      { db }
    );

    expect(result).toEqual(mockUser);
    expect(db.users.findById).toHaveBeenCalledWith('1');
  });

  test('obtener todos los usuarios', async () =&gt; {
    const mockUsers = [
      { id: '1', name: 'Juan' },
      { id: '2', name: 'María' }
    ];

    db.users.findAll.mockResolvedValue(mockUsers);

    const result = await resolvers.Query.users(
      null,
      {},
      { db }
    );

    expect(result).toEqual(mockUsers);
    expect(db.users.findAll).toHaveBeenCalled();
  });

  test('retornar null si usuario no existe', async () =&gt; {
    db.users.findById.mockResolvedValue(null);

    const result = await resolvers.Query.user(
      null,
      { id: '999' },
      { db }
    );

    expect(result).toBeNull();
  });
});</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Test de Mutations:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">describe('Mutation Resolvers', () =&gt; {
  let db;
  let userId = '1';

  beforeEach(() =&gt; {
    db = {
      users: {
        create: jest.fn(),
        update: jest.fn(),
        delete: jest.fn()
      }
    };
  });

  test('crear usuario con validación', async () =&gt; {
    const input = {
      name: 'Carlos',
      email: 'carlos@example.com',
      password: 'SecurePass123'
    };

    const newUser = { id: '3', ...input };
    db.users.create.mockResolvedValue(newUser);

    const result = await resolvers.Mutation.createUser(
      null,
      { input },
      { db }
    );

    expect(result.success).toBe(true);
    expect(result.user).toEqual(newUser);
    expect(db.users.create).toHaveBeenCalledWith(expect.objectContaining({
      name: 'Carlos'
    }));
  });

  test('fallar al crear usuario con email inválido', async () =&gt; {
    const input = {
      name: 'Carlos',
      email: 'invalid-email',
      password: 'SecurePass123'
    };

    const result = await resolvers.Mutation.createUser(
      null,
      { input },
      { db }
    );

    expect(result.success).toBe(false);
    expect(result.errors).toContainEqual(
      expect.objectContaining({
        field: 'email',
        code: 'INVALID_EMAIL'
      })
    );
    expect(db.users.create).not.toHaveBeenCalled();
  });

  test('actualizar usuario solo por el propietario', async () =&gt; {
    const post = { id: '1', authorId: '1' };
    const input = { title: 'Nuevo título' };

    db.posts = {
      findById: jest.fn().mockResolvedValue(post),
      update: jest.fn()
    };

    // Usuario correcto (es el autor)
    const result = await resolvers.Mutation.updatePost(
      null,
      { id: '1', input },
      { db, userId: '1' }
    );

    expect(result.success).toBe(true);
    expect(db.posts.update).toHaveBeenCalled();
  });

  test('rechazar actualización si no es el propietario', async () =&gt; {
    const post = { id: '1', authorId: '1' };

    db.posts = {
      findById: jest.fn().mockResolvedValue(post)
    };

    // Usuario incorrecto (no es el autor)
    const result = await resolvers.Mutation.updatePost(
      null,
      { id: '1', input: {} },
      { db, userId: '2' }
    );

    expect(result.success).toBe(false);
    expect(result.errors[0].code).toBe('UNAUTHORIZED');
  });
});</code></pre>
</div>
</div>
<hr>
<div class="paragraph">
<p><strong>Integration Tests</strong></p>
</div>
<div class="paragraph">
<p><strong>Testing con Apollo Server:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">import { ApolloServer, gql } from 'apollo-server';
import { typeDefs, resolvers } from '../schema';

describe('Integration Tests', () =&gt; {
  let server;
  let db;

  beforeAll(async () =&gt; {
    // Setup de base de datos de prueba
    db = {
      users: [],
      posts: [],
      comments: []
    };

    // Mock de contexto
    const contextValue = async () =&gt; ({
      db,
      userId: '1'
    });

    server = new ApolloServer({
      typeDefs,
      resolvers,
      context: contextValue
    });

    await server.start();
  });

  afterAll(async () =&gt; {
    await server.stop();
  });

  test('query completa: obtener usuario y posts', async () =&gt; {
    const GET_USER_WITH_POSTS = gql`
      query GetUserWithPosts($id: ID!) {
        user(id: $id) {
          id
          name
          email
          posts {
            id
            title
          }
        }
      }
    `;

    db.users = [
      { id: '1', name: 'Juan', email: 'juan@example.com' }
    ];

    db.posts = [
      { id: '1', title: 'Post 1', authorId: '1' },
      { id: '2', title: 'Post 2', authorId: '1' }
    ];

    const { body } = await server.executeOperation({
      query: GET_USER_WITH_POSTS,
      variables: { id: '1' }
    });

    expect(body.errors).toBeUndefined();
    expect(body.data.user.name).toBe('Juan');
    expect(body.data.user.posts).toHaveLength(2);
  });

  test('mutation completa: crear y obtener usuario', async () =&gt; {
    const CREATE_USER = gql`
      mutation CreateUser($input: CreateUserInput!) {
        createUser(input: $input) {
          user {
            id
            name
            email
          }
          success
          errors {
            field
            message
          }
        }
      }
    `;

    const { body } = await server.executeOperation({
      query: CREATE_USER,
      variables: {
        input: {
          name: 'María',
          email: 'maria@example.com',
          password: 'SecurePass123'
        }
      }
    });

    expect(body.errors).toBeUndefined();
    expect(body.data.createUser.success).toBe(true);
    expect(body.data.createUser.user.name).toBe('María');
  });

  test('flujo completo: crear post, comentar y obtener', async () =&gt; {
    // 1. Crear post
    const CREATE_POST = gql`
      mutation CreatePost($input: CreatePostInput!) {
        createPost(input: $input) {
          post { id title }
          success
        }
      }
    `;

    const createResult = await server.executeOperation({
      query: CREATE_POST,
      variables: {
        input: { title: 'Test', content: 'Content' }
      }
    });

    const postId = createResult.body.data.createPost.post.id;

    // 2. Agregar comentario
    const ADD_COMMENT = gql`
      mutation AddComment($input: CreateCommentInput!) {
        createComment(input: $input) {
          comment { id text }
          success
        }
      }
    `;

    const commentResult = await server.executeOperation({
      query: ADD_COMMENT,
      variables: {
        input: { postId, text: 'Great post!' }
      }
    });

    // 3. Obtener post con comentarios
    const GET_POST = gql`
      query GetPost($id: ID!) {
        post(id: $id) {
          id
          title
          comments { id text }
        }
      }
    `;

    const getResult = await server.executeOperation({
      query: GET_POST,
      variables: { id: postId }
    });

    expect(getResult.body.data.post.comments).toHaveLength(1);
  });
});</code></pre>
</div>
</div>
<hr>
<div class="paragraph">
<p><strong>Jest con GraphQL</strong></p>
</div>
<div class="paragraph">
<p><strong>Test de Schema Validation:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">import { buildSchema, graphql } from 'graphql';

describe('Schema Validation', () =&gt; {
  const schema = buildSchema(`
    type Query {
      user(id: ID!): User
      users: [User!]!
    }

    type User {
      id: ID!
      name: String!
      email: String!
    }
  `);

  test('query válida pasa validación', async () =&gt; {
    const query = `
      query {
        users {
          id
          name
        }
      }
    `;

    const result = await graphql({
      schema,
      source: query
    });

    expect(result.errors).toBeUndefined();
  });

  test('query inválida falla validación', async () =&gt; {
    const query = `
      query {
        users {
          nonExistentField
        }
      }
    `;

    const result = await graphql({
      schema,
      source: query
    });

    expect(result.errors).toBeDefined();
    expect(result.errors[0].message).toContain('nonExistentField');
  });
});</code></pre>
</div>
</div>
<hr>
<div class="paragraph">
<p><strong>Mocking de Datos</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">// __mocks__/database.js
export const mockUsers = [
  { id: '1', name: 'Juan', email: 'juan@example.com' },
  { id: '2', name: 'María', email: 'maria@example.com' }
];

export const mockPosts = [
  { id: '1', title: 'Post 1', authorId: '1', content: 'Content 1' },
  { id: '2', title: 'Post 2', authorId: '2', content: 'Content 2' }
];

export const createMockDb = () =&gt; ({
  users: {
    findById: jest.fn((id) =&gt;
      mockUsers.find(u =&gt; u.id === id)
    ),
    findAll: jest.fn(() =&gt; mockUsers),
    create: jest.fn((input) =&gt; ({
      id: String(mockUsers.length + 1),
      ...input
    })),
    update: jest.fn((id, input) =&gt; ({
      ...mockUsers.find(u =&gt; u.id === id),
      ...input
    }))
  },
  posts: {
    findById: jest.fn((id) =&gt;
      mockPosts.find(p =&gt; p.id === id)
    ),
    findAll: jest.fn(() =&gt; mockPosts)
  }
});</code></pre>
</div>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="_8_2_testing_de_clientes_graphql">8.2 Testing de Clientes GraphQL</h4>
<div class="paragraph">
<p><strong>Testing de Queries en Cliente</strong></p>
</div>
<div class="paragraph">
<p><strong>Setup con Apollo Client:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">import { ApolloClient, InMemoryCache, gql } from '@apollo/client';
import { MockedProvider } from '@apollo/client/testing';

const mockQuery = gql`
  query GetUser($id: ID!) {
    user(id: $id) {
      id
      name
      email
    }
  }
`;

const mocks = [
  {
    request: {
      query: mockQuery,
      variables: { id: '1' }
    },
    result: {
      data: {
        user: {
          id: '1',
          name: 'Juan',
          email: 'juan@example.com'
        }
      }
    }
  }
];

describe('Query Testing', () =&gt; {
  test('query devuelve datos correctos', async () =&gt; {
    const client = new ApolloClient({
      cache: new InMemoryCache(),
      link: new MockLink(mocks)
    });

    const { data } = await client.query({
      query: mockQuery,
      variables: { id: '1' }
    });

    expect(data.user.name).toBe('Juan');
  });
});</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Testing de Mutations:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const mockMutation = gql`
  mutation CreateUser($input: CreateUserInput!) {
    createUser(input: $input) {
      user {
        id
        name
        email
      }
      success
    }
  }
`;

const mutationMocks = [
  {
    request: {
      query: mockMutation,
      variables: {
        input: {
          name: 'Carlos',
          email: 'carlos@example.com',
          password: 'Pass123'
        }
      }
    },
    result: {
      data: {
        createUser: {
          user: {
            id: '3',
            name: 'Carlos',
            email: 'carlos@example.com'
          },
          success: true
        }
      }
    }
  }
];

describe('Mutation Testing', () =&gt; {
  test('mutation crea usuario correctamente', async () =&gt; {
    const client = new ApolloClient({
      cache: new InMemoryCache(),
      link: new MockLink(mutationMocks)
    });

    const { data } = await client.mutate({
      mutation: mockMutation,
      variables: {
        input: {
          name: 'Carlos',
          email: 'carlos@example.com',
          password: 'Pass123'
        }
      }
    });

    expect(data.createUser.success).toBe(true);
    expect(data.createUser.user.id).toBe('3');
  });
});</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Testing de Componentes React:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">import { render, screen, waitFor } from '@testing-library/react';
import { MockedProvider } from '@apollo/client/testing';
import UserProfile from './UserProfile';

const mockQuery = gql`
  query GetUser($id: ID!) {
    user(id: $id) {
      id
      name
      email
    }
  }
`;

const mocks = [
  {
    request: {
      query: mockQuery,
      variables: { id: '1' }
    },
    result: {
      data: {
        user: {
          id: '1',
          name: 'Juan',
          email: 'juan@example.com'
        }
      }
    }
  }
];

describe('UserProfile Component', () =&gt; {
  test('renderiza datos del usuario', async () =&gt; {
    render(
      &lt;MockedProvider mocks={mocks}&gt;
        &lt;UserProfile userId="1" /&gt;
      &lt;/MockedProvider&gt;
    );

    // Esperar a que se carguen los datos
    await waitFor(() =&gt; {
      expect(screen.getByText('Juan')).toBeInTheDocument();
    });
  });

  test('muestra error si la query falla', async () =&gt; {
    const errorMocks = [
      {
        request: {
          query: mockQuery,
          variables: { id: '999' }
        },
        error: new Error('Usuario no encontrado')
      }
    ];

    render(
      &lt;MockedProvider mocks={errorMocks}&gt;
        &lt;UserProfile userId="999" /&gt;
      &lt;/MockedProvider&gt;
    );

    await waitFor(() =&gt; {
      expect(screen.getByText(/error/i)).toBeInTheDocument();
    });
  });
});</code></pre>
</div>
</div>
<hr>
<div class="paragraph">
<p><strong>Mock de Apollo Client:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">import { useQuery } from '@apollo/client';

// Mock completo de Apollo Client
jest.mock('@apollo/client', () =&gt; ({
  ...jest.requireActual('@apollo/client'),
  useQuery: jest.fn()
}));

describe('Hook Testing', () =&gt; {
  test('hook devuelve datos cuando carga', () =&gt; {
    useQuery.mockReturnValue({
      data: {
        user: { id: '1', name: 'Juan' }
      },
      loading: false,
      error: undefined
    });

    const { result } = renderHook(() =&gt; useQuery(mockQuery));

    expect(result.current.data.user.name).toBe('Juan');
    expect(result.current.loading).toBe(false);
  });

  test('hook muestra loading al inicio', () =&gt; {
    useQuery.mockReturnValue({
      data: undefined,
      loading: true,
      error: undefined
    });

    const { result } = renderHook(() =&gt; useQuery(mockQuery));

    expect(result.current.loading).toBe(true);
  });
});</code></pre>
</div>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="_8_3_debugging_y_monitoreo">8.3 Debugging y Monitoreo</h4>
<div class="paragraph">
<p><strong>GraphQL Playground</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash"># Instalar GraphQL Playground
npm install @apollographql/graphql-playground-html

# En servidor Express
const { renderPlaygroundPage } = require('@apollographql/graphql-playground-html');

app.get('/playground', (req, res) =&gt; {
  res.setHeader('Content-Type', 'text/html');
  const playground = renderPlaygroundPage({
    endpoint: 'http://localhost:4000/graphql'
  });
  res.write(playground);
  res.end();
});</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Usar GraphQL Playground:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>1. Visitar http://localhost:4000/playground
2. Escribir query en la sección izquierda
3. Ejecutar y ver resultados
4. Explorar schema con Docs</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Apollo DevTools</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">// En cliente React
import { ApolloDevtools } from '@apollo/devtools';

&lt;ApolloDevtools client={client} /&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Características:
- Inspeccionar queries y mutations
- Ver cache de Apollo
- Timeline de operaciones
- Análisis de performance</p>
</div>
<hr>
<div class="paragraph">
<p><strong>Logging</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">// logger.js
export const logger = {
  query: (query, variables) =&gt; {
    console.log(`[QUERY] ${query.definitions[0].name.value}`);
    console.log('Variables:', variables);
  },

  mutation: (mutation, variables) =&gt; {
    console.log(`[MUTATION] ${mutation.definitions[0].name.value}`);
    console.log('Variables:', variables);
  },

  error: (error) =&gt; {
    console.error('[ERROR]', {
      message: error.message,
      path: error.path,
      extensions: error.extensions
    });
  },

  performance: (operationName, duration) =&gt; {
    console.log(`[PERF] ${operationName} tomó ${duration}ms`);
  }
};

// En Apollo Server
const server = new ApolloServer({
  typeDefs,
  resolvers,
  plugins: {
    didResolveOperation: ({ operationName, variables }) =&gt; {
      logger.query(operationName, variables);
    },

    didEncounterErrors: ({ errors }) =&gt; {
      for (const error of errors) {
        logger.error(error);
      }
    }
  }
});</code></pre>
</div>
</div>
<hr>
<div class="paragraph">
<p><strong>Performance Monitoring</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">// Middleware de timing
const timingMiddleware = (req, res, next) =&gt; {
  const start = Date.now();

  res.on('finish', () =&gt; {
    const duration = Date.now() - start;
    console.log(`[PERF] ${req.method} ${req.path} - ${duration}ms`);
  });

  next();
};

app.use(timingMiddleware);

// Monitoreo de queries complejas
const complexityPlugin = {
  didResolveOperation({ request, schema }) {
    const complexity = getComplexity({
      schema,
      query: request.query,
      variables: request.variables,
      estimators: { ...defaultEstimators }
    });

    if (complexity &gt; MAX_COMPLEXITY) {
      console.warn(`[COMPLEXITY] Query demasiado compleja: ${complexity}`);
    }
  }
};</code></pre>
</div>
</div>
<hr>
<div class="paragraph">
<p><strong>Debugging de Resolvers</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">// Con logs detallados
const resolvers = {
  Query: {
    user: async (_, { id }, { db }) =&gt; {
      console.log(`[RESOLVER] Query.user called with id=${id}`);

      try {
        const user = await db.users.findById(id);
        console.log(`[RESOLVER] User found:`, user);
        return user;
      } catch (error) {
        console.error(`[RESOLVER] Error finding user:`, error);
        throw error;
      }
    }
  },

  User: {
    posts: async (parent, _, { db }) =&gt; {
      console.log(`[RESOLVER] User.posts called for userId=${parent.id}`);

      try {
        const posts = await db.posts.findByUserId(parent.id);
        console.log(`[RESOLVER] Found ${posts.length} posts`);
        return posts;
      } catch (error) {
        console.error(`[RESOLVER] Error finding posts:`, error);
        throw error;
      }
    }
  }
};</code></pre>
</div>
</div>
<hr>
<div class="paragraph">
<p><strong>Debugging con Breakpoints:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">// En Node.js
node --inspect server.js

// Luego abrir chrome://inspect en Chrome
// O usar VS Code debugger</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>launch.json para VS Code:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "version": "0.2.0",
  "configurations": [
    {
      "type": "node",
      "request": "launch",
      "name": "Launch GraphQL Server",
      "program": "${workspaceFolder}/server.js",
      "restart": true,
      "console": "integratedTerminal"
    }
  ]
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2025-11-14 09:27:08 +0100
</div>
</div>
</body>
</html>